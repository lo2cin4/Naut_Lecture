<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>æ¨¡çµ„ 05Bï¼šæ•¸æ“šç®¡ç†èˆ‡æŒä¹…åŒ– â€” NautilusTrader æ•™æ</title>
<meta content="å¾ CSV åˆ° DataCatalogï¼šæŒæ¡ NautilusTrader çš„æ•¸æ“šç®¡ç·š" name="description"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=Noto+Sans+TC:wght@300;400;500;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet"/>
<link href="../assets/style.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
<!-- Language Toggle -->
<style>
.lang-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(43, 48, 59, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 6px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    text-decoration: none;
    color: var(--text-secondary, #A0AEC0);
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.lang-toggle:hover {
    background: rgba(60, 65, 75, 0.9);
    color: var(--text-primary, #F7FAFC);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}
.lang-toggle span.active {
    color: #64ffda;
    font-weight: 600;
}
.lang-toggle svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
}
</style>
<a class="lang-toggle" href="../en/Module_05B_Data_Management/index.html" title="Switch to English">
<svg viewbox="0 0 24 24"><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>
<span>EN / <span class="active">ä¸­</span></span>
</a>

<!-- Language Toggle -->


<div class="page-wrapper">
<!-- å´é‚Šæ¬„ -->
<nav class="sidebar">
<div class="sidebar-header">
<div class="sidebar-logo"><span class="icon">ğŸš</span> NautilusTrader æ•™æ</div>
</div>
<div class="sidebar-nav">
<div class="nav-section">
<div class="nav-section-title">ç¬¬é›¶éšæ®µï¼šèµ·æ­¥</div>
</div>
<a class="nav-item" href="../Module_00_Getting_Started/index.html"><span class="nav-num">00</span>
                    ç’°å¢ƒå®‰è£</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬ä¸€éšæ®µï¼šå…¨å±€èªè­˜</div>
</div>
<a class="nav-item" href="../Module_01_Why_NautilusTrader/index.html"><span class="nav-num">01</span>
                    ç‚ºä»€éº¼é¸æ“‡</a>
<a class="nav-item" href="../Module_02_Architecture_Overview/index.html"><span class="nav-num">02</span>
                    æ•´é«”æ¶æ§‹</a>
<a class="nav-item" href="../Module_03_Design_Philosophy/index.html"><span class="nav-num">03</span>
                    è¨­è¨ˆå“²å­¸</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬äºŒéšæ®µï¼šæ ¸å¿ƒçµ„ä»¶</div>
</div>
<a class="nav-item" href="../Module_04_Domain_Model/index.html"><span class="nav-num">04</span> é ˜åŸŸæ¨¡å‹</a>
<a class="nav-item" href="../Module_05_MessageBus/index.html"><span class="nav-num">05</span> æ¶ˆæ¯ç¸½ç·š</a>
<a class="nav-item active" href="index.html"><span class="nav-num">05B</span> æ•¸æ“šç®¡ç†</a>
<a class="nav-item" href="../Module_05B_Data_Management/index.html"><span class="nav-num">05B</span>
                    æ•¸æ“šç®¡ç†</a>
<a class="nav-item" href="../Module_06_Cache/index.html"><span class="nav-num">06</span> ç·©å­˜ç³»çµ±</a>
<a class="nav-item" href="../Module_07_DataEngine/index.html"><span class="nav-num">07</span> æ•¸æ“šå¼•æ“</a>
<a class="nav-item" href="../Module_08_ExecutionEngine/index.html"><span class="nav-num">08</span>
                    åŸ·è¡Œå¼•æ“</a>
<a class="nav-item" href="../Module_09_RiskEngine/index.html"><span class="nav-num">09</span> é¢¨æ§å¼•æ“</a>
<a class="nav-item" href="../Module_10_Portfolio/index.html"><span class="nav-num">10</span> æŠ•è³‡çµ„åˆ</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬ä¸‰éšæ®µï¼šå¯¦æˆ°æ‡‰ç”¨</div>
</div>
<a class="nav-item" href="../Module_11_Strategy_Development/index.html"><span class="nav-num">11</span>
                    ç­–ç•¥é–‹ç™¼</a>
<a class="nav-item" href="../Module_12_Backtest_And_Live/index.html"><span class="nav-num">12</span>
                    å›æ¸¬èˆ‡å¯¦ç›¤</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬å››éšæ®µï¼šé€²éšæ“´å±•</div>
</div>
<a class="nav-item" href="../Module_13_Adapters_Extensions/index.html"><span class="nav-num">13</span>
                    é©é…å™¨èˆ‡æ“´å±•</a>
<a class="nav-item" href="../Module_14_Configuration/index.html"><span class="nav-num">14</span>
                    é…ç½®ç³»çµ±æ·±æ½›</a>
<a class="nav-item" href="../Module_15_Live_Advanced/index.html"><span class="nav-num">15</span>
                    å¯¦ç›¤éƒ¨ç½²é€²éš</a>
<a class="nav-item" href="../Module_16_Accounting_Risk/index.html"><span class="nav-num">16</span>
                    æœƒè¨ˆèˆ‡é¢¨æ§</a>
<a class="nav-item" href="../Module_17_Advanced_Topics/index.html"><span class="nav-num">17</span>
                    é€²éšä¸»é¡Œ</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬äº”éšæ®µï¼šå‹•æ‰‹ Lab</div>
</div>
<a class="nav-item" href="../Lab_01_Backtest_Workflow/index.html"><span class="nav-num">L1</span> Lab
                    01</a>
<a class="nav-item" href="../Lab_02_Binance_Sandbox/index.html"><span class="nav-num">L2</span> Lab
                    02</a>
<a class="nav-item" href="../Lab_03_Custom_Strategy/index.html"><span class="nav-num">L3</span> Lab
                    03</a>
</div>
</nav>
<!-- ä¸»å…§å®¹ -->
<div class="main-content">
<div class="top-bar">
<button aria-label="é–‹å•Ÿé¸å–®" class="menu-toggle">â˜°</button>
<div class="breadcrumb"><a href="../index.html">é¦–é </a><span class="separator">â€º</span>ç¬¬äºŒéšæ®µ<span class="separator">â€º</span>æ¨¡çµ„ 05B</div>
</div>
<div class="content-container">
<span class="phase-label phase-2">ç¬¬äºŒéšæ®µï¼šæ ¸å¿ƒçµ„ä»¶æ·±åº¦è§£è®€</span>
<h1>æ¨¡çµ„ 05Bï¼šæ•¸æ“šç®¡ç†èˆ‡æŒä¹…åŒ–<span class="subtitle">å¾ä½ çš„ CSV åˆ° NautilusTrader èƒ½è®€çš„æ ¼å¼</span></h1>
<p>NautilusTrader éœ€è¦ç‰¹å®šæ ¼å¼çš„æ•¸æ“šæ‰èƒ½é‹è¡Œå›æ¸¬ã€‚é€™å€‹æ¨¡çµ„æ•™ä½ å¦‚ä½•æŠŠå„ç¨®ä¾†æºçš„æ•¸æ“šè½‰æ›ã€å­˜å„²ã€å’Œè¼‰å…¥åˆ°ç³»çµ±ä¸­ã€‚</p>
<!-- ==================== -->
<h2>ä¸€ã€æ•¸æ“šç®¡ç·šå…¨æ™¯</h2>
<p>æ•¸æ“šå¾ä½ è‡ªå·±çš„æª”æ¡ˆåˆ°å›æ¸¬å¼•æ“ï¼Œéœ€è¦ç¶“éä»¥ä¸‹æ­¥é©Ÿï¼š</p>
<div class="mermaid-wrapper">
<div class="mermaid">
                        flowchart LR
                        subgraph source["ğŸ“ æ•¸æ“šä¾†æº"]
                        direction TB
                        csv["CSV æª”æ¡ˆ"]
                        api["äº¤æ˜“æ‰€ API"]
                        vendor["æ•¸æ“šä¾›æ‡‰å•†<br/>(Databento/Tardis)"]
                        end

                        subgraph transform["ğŸ”„ æ•¸æ“šè½‰æ›"]
                        direction TB
                        wrangler["Wrangler<br/>æ•¸æ“šæ•´ç†å™¨"]
                        loader["DataLoader<br/>æ•¸æ“šè¼‰å…¥å™¨"]
                        end

                        subgraph storage["ğŸ’¾ æ•¸æ“šå­˜å„²"]
                        direction TB
                        catalog["DataCatalog<br/>(Parquet æ ¼å¼)"]
                        memory["ç›´æ¥è¼‰å…¥è¨˜æ†¶é«”"]
                        end

                        subgraph engine["âš™ï¸ å›æ¸¬å¼•æ“"]
                        direction TB
                        backtest["BacktestEngine"]
                        end

                        source ==&gt; transform ==&gt; storage ==&gt; engine
                    </div>
<div class="caption">åœ– 1ï¼šæ•¸æ“šå¾ä¾†æºåˆ°å›æ¸¬å¼•æ“çš„å®Œæ•´ç®¡ç·š</div>
</div>
<!-- ==================== -->
<h2>äºŒã€Wrangler â€” æ•¸æ“šæ ¼å¼è½‰æ›å™¨</h2>
<div class="callout callout-info">
<div class="callout-title">ğŸ’¡ ç‚ºä»€éº¼éœ€è¦ Wranglerï¼Ÿ</div>
<p><strong>âŒ å¦‚æœç›´æ¥ç”¨ pandas DataFrame</strong>ï¼šNautilusTrader ä¸èªè­˜ DataFrameã€‚å®ƒéœ€è¦çš„æ˜¯
                        <code>QuoteTick</code>ã€<code>TradeTick</code>ã€<code>Bar</code> ç­‰å°ˆç”¨æ•¸æ“šå°è±¡ï¼Œå› ç‚ºé€™äº›å°è±¡ç¶“é Rust å„ªåŒ–ï¼Œé€Ÿåº¦æ¯”åŸå§‹
                        Python å¿« 100 å€ä»¥ä¸Šã€‚
                    </p>
<p><strong>âœ… ç”¨ Wrangler</strong>ï¼šå®ƒå¹«ä½ æŠŠ pandas DataFrame è½‰æ›æˆ NautilusTrader å°ˆç”¨çš„æ•¸æ“šå°è±¡ï¼Œä¸€è¡Œä»£ç¢¼æå®šã€‚</p>
</div>
<h3>å¾ CSV è¼‰å…¥ K ç·šæ•¸æ“š</h3>
<pre><code class="language-python">"""
å¾è‡ªå·±çš„ CSV æª”æ¡ˆè¼‰å…¥ K ç·šæ•¸æ“šåˆ° NautilusTrader
"""
import pandas as pd
from nautilus_trader.persistence.wranglers import BarDataWrangler
from nautilus_trader.model.data import BarType
from nautilus_trader.model.identifiers import InstrumentId

# 1. ç”¨ pandas è®€å–ä½ çš„ CSV
df = pd.read_csv("my_btc_data.csv")
# ä½ çš„ CSV æ¬„ä½å¯èƒ½æ˜¯ï¼štimestamp, open, high, low, close, volume

# 2. ç¢ºä¿ç´¢å¼•æ˜¯æ™‚é–“æˆ³
df["timestamp"] = pd.to_datetime(df["timestamp"])
df = df.set_index("timestamp")

# 3. å®šç¾© BarTypeï¼ˆä»€éº¼å“ç¨®ã€ä»€éº¼æ™‚é–“æ¡†æ¶ï¼‰
bar_type = BarType.from_str("BTC-USDT-PERP.BINANCE-1-MINUTE-LAST-EXTERNAL")
#                             å“ç¨®                   æ™‚é–“æ¡†æ¶  åƒ¹æ ¼é¡å‹  ä¾†æº

# 4. ç”¨ Wrangler è½‰æ›ï¼
wrangler = BarDataWrangler(bar_type=bar_type, instrument=instrument)
bars = wrangler.process(df)  # è¿”å› list[Bar]

print(f"âœ… è¼‰å…¥äº† {len(bars)} æ ¹ K ç·š")
print(f"ç¬¬ä¸€æ ¹: {bars[0]}")
print(f"æœ€å¾Œæ ¹: {bars[-1]}")</code></pre>
<h3>å…¶å®ƒ Wrangler ç¨®é¡</h3>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th>Wrangler</th>
<th>è¼¸å…¥ DataFrame æ¬„ä½</th>
<th>è¼¸å‡ºæ•¸æ“šé¡å‹</th>
<th>é©ç”¨å ´æ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>QuoteTickDataWrangler</code></td>
<td>bid, ask, bid_size, ask_size</td>
<td><code>QuoteTick</code></td>
<td>æœ‰å®Œæ•´å ±åƒ¹æ•¸æ“šï¼ˆå¤–åŒ¯ã€åŠ å¯†è²¨å¹£ï¼‰</td>
</tr>
<tr>
<td><code>TradeTickDataWrangler</code></td>
<td>price, quantity, aggressor_side</td>
<td><code>TradeTick</code></td>
<td>é€ç­†æˆäº¤æ•¸æ“š</td>
</tr>
<tr>
<td><code>BarDataWrangler</code></td>
<td>open, high, low, close, volume</td>
<td><code>Bar</code></td>
<td>K ç·šæ•¸æ“šï¼ˆæœ€å¸¸è¦‹ï¼‰</td>
</tr>
<tr>
<td><code>OrderBookDeltaDataWrangler</code></td>
<td>action, side, price, size</td>
<td><code>OrderBookDelta</code></td>
<td>è¨‚å–®ç°¿å¢é‡æ•¸æ“šï¼ˆé«˜é »ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<!-- ==================== -->
<h2>ä¸‰ã€DataCatalog â€” æ•¸æ“šå€‰åº«</h2>
<div class="callout callout-info">
<div class="callout-title">ğŸ’¡ ç‚ºä»€éº¼éœ€è¦ DataCatalogï¼Ÿ</div>
<p><strong>âŒ å¦‚æœæ¯æ¬¡å›æ¸¬éƒ½å¾ CSV é‡æ–°è®€å–</strong>ï¼šCSV æ˜¯æ–‡å­—æ ¼å¼ï¼Œè§£ææ…¢ã€‚100 è¬æ ¹ K ç·šå¯èƒ½éœ€è¦ 30 ç§’ä»¥ä¸Šã€‚è€Œä¸”ä½ éœ€è¦æ¯æ¬¡éƒ½é‡æ–°åš Wrangler è½‰æ›ã€‚
                    </p>
<p><strong>âœ… ç”¨ DataCatalog</strong>ï¼šå®ƒæŠŠæ•¸æ“šå­˜ç‚º <strong>Parquet æ ¼å¼</strong>ï¼ˆäºŒé€²åˆ¶åˆ—å¼å­˜å„²ï¼‰ï¼Œè®€å–é€Ÿåº¦æ¯” CSV å¿« 10-50
                        å€ã€‚è€Œä¸”ä¸€æ¬¡å¯«å…¥ã€å¤šæ¬¡è®€å–ï¼Œä¸éœ€è¦é‡è¤‡è½‰æ›ã€‚</p>
</div>
<div class="mermaid-wrapper">
<div class="mermaid">
                        flowchart LR
                        subgraph write["âœï¸ å¯«å…¥ï¼ˆåªåšä¸€æ¬¡ï¼‰"]
                        direction TB
                        w1["CSV â†’ Wrangler â†’ Bars"]
                        w2["catalog.write_data(bars)"]
                        w1 --&gt; w2
                        end

                        subgraph read["ğŸ“– è®€å–ï¼ˆæ¯æ¬¡å›æ¸¬ï¼‰"]
                        direction TB
                        r1["catalog.bars()"]
                        r2["ç›´æ¥å¾—åˆ° list å°è±¡"]
                        r1 --&gt; r2
                        end

                        subgraph format["ğŸ“¦ Parquet æ ¼å¼"]
                        direction TB
                        f1["äºŒé€²åˆ¶åˆ—å¼å­˜å„²"]
                        f2["å£“ç¸®æ¯” 5-10x"]
                        f3["æ”¯æ´æ™‚é–“ç¯„åœæŸ¥è©¢"]
                        end

                        write --&gt; format --&gt; read

                        style format fill:#0f1419,stroke:#4fc3f7,stroke-width:2px
                    </div>
<div class="caption">åœ– 2ï¼šDataCatalog çš„å¯«å…¥èˆ‡è®€å–æµç¨‹</div>
</div>
<h3>å¯«å…¥æ•¸æ“šåˆ° Catalog</h3>
<pre><code class="language-python">"""
æŠŠæ•¸æ“šå­˜å…¥ DataCatalogï¼ˆåªéœ€åšä¸€æ¬¡ï¼‰
"""
from nautilus_trader.persistence.catalog import ParquetDataCatalog

# 1. æŒ‡å®š Catalog çš„å­˜å„²ç›®éŒ„
catalog = ParquetDataCatalog("./my_catalog")

# 2. å¯«å…¥æ•¸æ“šï¼ˆbars æ˜¯ä¸Šä¸€æ­¥ Wrangler ç”¢å‡ºçš„ï¼‰
catalog.write_data(bars)
print(f"âœ… å·²å¯«å…¥ {len(bars)} æ ¹ K ç·šåˆ° Catalog")

# ç›®éŒ„çµæ§‹æœƒè®Šæˆï¼š
# ./my_catalog/
# â””â”€â”€ bar/
#     â””â”€â”€ BTC-USDT-PERP.BINANCE-1-MINUTE-LAST-EXTERNAL/
#         â””â”€â”€ part-0.parquet      â† äºŒé€²åˆ¶æ•¸æ“šæª”æ¡ˆ</code></pre>
<h3>å¾ Catalog è®€å–æ•¸æ“š</h3>
<pre><code class="language-python">"""
å¾ DataCatalog è®€å–æ•¸æ“šï¼ˆæ¯æ¬¡å›æ¸¬éƒ½ç”¨é€™å€‹ï¼‰
"""
from nautilus_trader.persistence.catalog import ParquetDataCatalog

catalog = ParquetDataCatalog("./my_catalog")

# è®€å–æ‰€æœ‰ K ç·š
bars = catalog.bars()

# æˆ–è€…æŒ‰æ™‚é–“ç¯„åœè®€å–ï¼ˆåªè®€ 2024 å¹´ 1 æœˆçš„æ•¸æ“šï¼‰
from datetime import datetime
bars_jan = catalog.bars(
    start=datetime(2024, 1, 1),
    end=datetime(2024, 2, 1),
)

# è®€å–ç‰¹å®šå“ç¨®
bars_btc = catalog.bars(
    bar_types=["BTC-USDT-PERP.BINANCE-1-MINUTE-LAST-EXTERNAL"],
)

print(f"ğŸ“Š è®€å–äº† {len(bars)} æ ¹ K ç·šï¼ˆé€Ÿåº¦ï¼šæ¯«ç§’ç´šï¼ï¼‰")</code></pre>
<!-- ==================== -->
<h2>å››ã€K ç·šèšåˆ â€” è‡ªå®šç¾©æ™‚é–“æ¡†æ¶</h2>
<div class="callout callout-info">
<div class="callout-title">ğŸ’¡ ç‚ºä»€éº¼éœ€è¦ K ç·šèšåˆï¼Ÿ</div>
<p><strong>âŒ å¦‚æœåªèƒ½ç”¨æ•¸æ“šæºæä¾›çš„æ™‚é–“æ¡†æ¶</strong>ï¼šä½ çš„æ•¸æ“šæºå¯èƒ½åªæœ‰ 1 åˆ†é˜ K ç·šã€‚ä½†ä½ çš„ç­–ç•¥éœ€è¦ 15 åˆ†é˜æˆ– 4 å°æ™‚ K ç·šã€‚ä½ éœ€è¦è‡ªå·±å¯«ä»£ç¢¼æŠŠ 1 åˆ†é˜ K
                        ç·šåˆä½µæˆæ›´å¤§çš„æ™‚é–“æ¡†æ¶â€”â€”å®¹æ˜“å‡ºéŒ¯ã€‚</p>
<p><strong>âœ… ç”¨ BarAggregator</strong>ï¼šNautilusTrader å…§å»º K
                        ç·šèšåˆå™¨ï¼Œå¯ä»¥è‡ªå‹•æŠŠä»»ä½•æ™‚é–“æ¡†æ¶çš„æ•¸æ“šèšåˆæˆä½ éœ€è¦çš„æ™‚é–“æ¡†æ¶ã€‚è€Œä¸”å®ƒæ”¯æ´ä¸åªæ˜¯æ™‚é–“ï¼Œé‚„èƒ½æŒ‰æˆäº¤é‡ã€æˆäº¤ç­†æ•¸èšåˆã€‚</p>
</div>
<pre><code class="language-python">"""
åœ¨ç­–ç•¥ä¸­è¨‚é–±è‡ªå®šç¾©æ™‚é–“æ¡†æ¶çš„ K ç·š
"""
class MyStrategy(Strategy):
    def on_start(self):
        # è¨‚é–± 15 åˆ†é˜ K ç·šï¼ˆå¼•æ“æœƒè‡ªå‹•å¾ 1 åˆ†é˜ K ç·šèšåˆï¼‰
        bar_type_15m = BarType.from_str(
            "BTC-USDT-PERP.BINANCE-15-MINUTE-LAST-INTERNAL"
            #                                            ^^^^^^^^
            # INTERNAL = NautilusTrader è‡ªå·±èšåˆ
            # EXTERNAL = ç”±å¤–éƒ¨æ•¸æ“šæºæä¾›
        )
        self.subscribe_bars(bar_type_15m)

        # ä½ ç”šè‡³å¯ä»¥è¨‚é–±æŒ‰ã€Œæˆäº¤é‡ã€èšåˆçš„ K ç·šï¼
        bar_type_volume = BarType.from_str(
            "BTC-USDT-PERP.BINANCE-1000-VOLUME-LAST-INTERNAL"
            # æ¯ç´¯ç© 1000 å–®ä½æˆäº¤é‡å°±ç”Ÿæˆä¸€æ ¹ K ç·š
        )
        self.subscribe_bars(bar_type_volume)

    def on_bar(self, bar: Bar):
        # ç•¶èšåˆå®Œçš„ K ç·šåˆ°é”æ™‚ï¼Œé€™å€‹å›èª¿è¢«è§¸ç™¼
        self.log.info(f"æ”¶åˆ° K ç·š: {bar}")</code></pre>
<h3>K ç·šèšåˆé¡å‹</h3>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th>èšåˆæ–¹å¼</th>
<th>BarType æ ¼å¼</th>
<th>èªªæ˜</th>
<th>é©ç”¨ç­–ç•¥</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™‚é–“èšåˆ</td>
<td><code>15-MINUTE</code></td>
<td>æ¯ 15 åˆ†é˜ä¸€æ ¹</td>
<td>è¶¨å‹¢è·Ÿéš¨ç­–ç•¥</td>
</tr>
<tr>
<td>æˆäº¤é‡èšåˆ</td>
<td><code>1000-VOLUME</code></td>
<td>æ¯ 1000 å–®ä½æˆäº¤é‡ä¸€æ ¹</td>
<td>é‡èƒ½çªç ´ç­–ç•¥</td>
</tr>
<tr>
<td>ç­†æ•¸èšåˆ</td>
<td><code>500-TICK</code></td>
<td>æ¯ 500 ç­†äº¤æ˜“ä¸€æ ¹</td>
<td>é«˜é »äº¤æ˜“ç­–ç•¥</td>
</tr>
<tr>
<td>åƒ¹å€¼èšåˆ</td>
<td><code>1000000-VALUE</code></td>
<td>æ¯ 100 è¬å–®ä½åƒ¹å€¼ä¸€æ ¹</td>
<td>åˆç´„é¡ç­–ç•¥</td>
</tr>
</tbody>
</table>
</div>
<!-- ==================== -->
<h2>äº”ã€è‡ªå®šç¾©æ•¸æ“šé¡å‹</h2>
<p>å¦‚æœä½ æœ‰è‡ªå·±çš„æ•¸æ“šï¼ˆä¾‹å¦‚ï¼šæƒ…ç·’æŒ‡æ¨™ã€æ–°èäº‹ä»¶ï¼‰ï¼Œå¯ä»¥å®šç¾©è‡ªå®šç¾©æ•¸æ“šé¡å‹åœ¨ NautilusTrader ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="language-python">"""
å®šç¾©ä¸€å€‹è‡ªå®šç¾©æ•¸æ“šé¡å‹ï¼šå¸‚å ´æƒ…ç·’æŒ‡æ•¸
"""
from nautilus_trader.model.custom import customdataclass

# ç”¨ @customdataclass è£é£¾å™¨å®šç¾©è‡ªå®šç¾©æ•¸æ“š
@customdataclass
class SentimentData:
    instrument_id: str   # å“ç¨® ID
    score: float         # æƒ…ç·’åˆ†æ•¸ (-1.0 åˆ° 1.0)
    source: str          # ä¾†æºï¼ˆTwitter, Reddit ç­‰ï¼‰

# åœ¨ç­–ç•¥ä¸­è¨‚é–±å’Œä½¿ç”¨
class MyStrategy(Strategy):
    def on_start(self):
        # è¨‚é–±è‡ªå®šç¾©æ•¸æ“š
        self.subscribe_data(
            data_type=SentimentData,
            metadata={"instrument_id": "BTC-USDT-PERP.BINANCE"},
        )

    def on_data(self, data):
        if isinstance(data, SentimentData):
            if data.score &gt; 0.8:
                self.log.info("ğŸŸ¢ å¸‚å ´æƒ…ç·’æ¥µåº¦æ¨‚è§€ï¼")
            elif data.score &lt; -0.8:
                self.log.info("ğŸ”´ å¸‚å ´æƒ…ç·’æ¥µåº¦æ‚²è§€ï¼")</code></pre>
<!-- ==================== -->
<h2>å…­ã€åºåˆ—åŒ–æ ¼å¼</h2>
<p>NautilusTrader æ”¯æ´å¤šç¨®åºåˆ—åŒ–æ ¼å¼ï¼Œç”¨æ–¼ä¸åŒå ´æ™¯ï¼š</p>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>ç”¨é€”</th>
<th>é€Ÿåº¦</th>
<th>èªªæ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Apache Arrow / Parquet</strong></td>
<td>æ•¸æ“šæŒä¹…åŒ–ï¼ˆDataCatalogï¼‰</td>
<td>âš¡âš¡âš¡</td>
<td>åˆ—å¼å­˜å„²ï¼Œå£“ç¸®ç‡é«˜ï¼Œè®€å–æ¥µå¿«</td>
</tr>
<tr>
<td><strong>MsgPack</strong></td>
<td>ç¶²è·¯å‚³è¼¸ã€Redis ç·©å­˜</td>
<td>âš¡âš¡</td>
<td>äºŒé€²åˆ¶ JSONï¼Œé«”ç©å°</td>
</tr>
<tr>
<td><strong>JSON</strong></td>
<td>é…ç½®æ–‡ä»¶ã€æ—¥èªŒ</td>
<td>âš¡</td>
<td>äººé¡å¯è®€ï¼Œæ–¹ä¾¿é™¤éŒ¯</td>
</tr>
</tbody>
</table>
</div>
<div class="callout callout-warning">
<div class="callout-title">âš ï¸ ç‚ºä»€éº¼ä¸ç›´æ¥ç”¨ JSON å­˜å„²æ‰€æœ‰æ•¸æ“šï¼Ÿ</div>
<p><strong>âŒ ç”¨ JSON å­˜ 100 è¬æ ¹ K ç·š</strong>ï¼šæª”æ¡ˆå¤§å°ç´„ 500MBï¼Œè®€å–éœ€è¦ 30+ ç§’ã€‚<br/>
<strong>âœ… ç”¨ Parquet å­˜ 100 è¬æ ¹ K ç·š</strong>ï¼šæª”æ¡ˆå¤§å°ç´„ 50MBï¼ˆå£“ç¸® 10 å€ï¼‰ï¼Œè®€å–åªéœ€ 1-2 ç§’ã€‚
                    </p>
</div>
<!-- ==================== -->
<h2>ä¸ƒã€äº’å‹•ç·´ç¿’</h2>
<div class="exercise-block">
<div class="exercise-title">ğŸ§  ç·´ç¿’ 1ï¼šé¸æ“‡æ­£ç¢ºçš„ Wrangler</div>
<p>ä½ æœ‰ä»¥ä¸‹ä¸‰ç¨®æ•¸æ“šï¼Œæ‡‰è©²åˆ†åˆ¥ç”¨å“ªå€‹ Wranglerï¼Ÿ</p>
<ol>
<li>ä¾†è‡ª Binance çš„ <code>bid, ask, bid_size, ask_size</code> å ±åƒ¹æ•¸æ“š</li>
<li>ä¾†è‡ª TradingView çš„ <code>open, high, low, close, volume</code> K ç·šæ•¸æ“š</li>
<li>ä¾†è‡ªæŸäº¤æ˜“æ‰€çš„é€ç­†æˆäº¤ <code>price, quantity, side</code> æ•¸æ“š</li>
</ol>
<button class="btn-run" onclick="toggleAnswer('answer-wrangler')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
<div class="exercise-output" id="answer-wrangler">
<ol>
<li><strong><code>QuoteTickDataWrangler</code></strong><br/>â†’ æœ‰
                                <code>bid</code>/<code>ask</code> å°±æ˜¯å ±åƒ¹æ•¸æ“š</li>
<li><strong><code>BarDataWrangler</code></strong><br/>â†’ æœ‰ <code>OHLCV</code> å°±æ˜¯ K ç·šæ•¸æ“š</li>
<li><strong><code>TradeTickDataWrangler</code></strong><br/>â†’ æœ‰
                                <code>price</code>/<code>quantity</code>/<code>side</code> å°±æ˜¯é€ç­†æˆäº¤</li>
</ol>
<p>ğŸ’¡ <strong>è¨£ç«…</strong>ï¼šçœ‹ DataFrame çš„æ¬„ä½åç¨±å°±èƒ½åˆ¤æ–·ç”¨å“ªå€‹ Wranglerã€‚</p>
</div>
</div>
<div class="exercise-block">
<div class="exercise-title">ğŸ§  ç·´ç¿’ 2ï¼šè§£è®€ BarType å­—ä¸²</div>
<p>ä»¥ä¸‹ BarType å­—ä¸²åˆ†åˆ¥ä»£è¡¨ä»€éº¼ï¼Ÿ</p>
<ol>
<li><code>ETH-USDT.BINANCE-5-MINUTE-LAST-EXTERNAL</code></li>
<li><code>BTC-USD.COINBASE-1000-VOLUME-LAST-INTERNAL</code></li>
<li><code>EUR-USD.SIM-1-HOUR-BID-INTERNAL</code></li>
</ol>
<button class="btn-run" onclick="toggleAnswer('answer-bartype')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
<div class="exercise-output" id="answer-bartype">
<ol>
<li><strong><code>ETH-USDT.BINANCE-5-MINUTE-LAST-EXTERNAL</code></strong>
<ul>
<li>å“ç¨®: ETH-USDTï¼ˆBinance äº¤æ˜“æ‰€ï¼‰</li>
<li>æ™‚é–“: 5 åˆ†é˜</li>
<li>åƒ¹æ ¼: LASTï¼ˆæœ€å¾Œæˆäº¤åƒ¹ï¼‰</li>
<li>ä¾†æº: EXTERNALï¼ˆæ•¸æ“šç”±å¤–éƒ¨æä¾›ï¼Œä¸æ˜¯è‡ªå·±èšåˆï¼‰</li>
</ul>
</li>
<li><strong><code>BTC-USD.COINBASE-1000-VOLUME-LAST-INTERNAL</code></strong>
<ul>
<li>å“ç¨®: BTC-USDï¼ˆCoinbase äº¤æ˜“æ‰€ï¼‰</li>
<li>èšåˆ: æ¯ 1000 å–®ä½æˆäº¤é‡</li>
<li>åƒ¹æ ¼: LASTï¼ˆæœ€å¾Œæˆäº¤åƒ¹ï¼‰</li>
<li>ä¾†æº: INTERNALï¼ˆç”± NautilusTrader è‡ªå·±å¾ tick èšåˆï¼‰</li>
</ul>
</li>
<li><strong><code>EUR-USD.SIM-1-HOUR-BID-INTERNAL</code></strong>
<ul>
<li>å“ç¨®: EUR-USDï¼ˆæ¨¡æ“¬äº¤æ˜“æ‰€ï¼‰</li>
<li>æ™‚é–“: 1 å°æ™‚</li>
<li>åƒ¹æ ¼: BIDï¼ˆè²·å…¥åƒ¹ï¼‰</li>
<li>ä¾†æº: INTERNALï¼ˆå¼•æ“è‡ªå·±èšåˆï¼‰</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="exercise-block">
<div class="exercise-title">ğŸ§  ç·´ç¿’ 3ï¼šè¨­è¨ˆæ•¸æ“šç®¡ç·š</div>
<p>ä½ æœ‰ä¸€å€‹ CSV æª”æ¡ˆï¼ŒåŒ…å«éå» 1 å¹´çš„ BTC 1 åˆ†é˜ K ç·šæ•¸æ“šï¼ˆç´„ 52 è¬è¡Œï¼‰ã€‚ä½ çš„ç­–ç•¥éœ€è¦ 15 åˆ†é˜ K ç·šã€‚æè¿°ä½ çš„æ•¸æ“šè™•ç†æ­¥é©Ÿã€‚</p>
<button class="btn-run" onclick="toggleAnswer('answer-pipeline')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
<div class="exercise-output" id="answer-pipeline">
<ol>
<li><strong>æ­¥é©Ÿ 1</strong>: ç”¨ pandas è®€å– CSV
                                <pre><code class="language-python">df = pd.read_csv("btc_1m.csv")</code></pre>
</li>
<li><strong>æ­¥é©Ÿ 2</strong>: ç”¨ <code>BarDataWrangler</code> è½‰æ›ç‚º <code>Bar</code> å°è±¡
                                <pre><code class="language-python">wrangler = BarDataWrangler(bar_type=..., instrument=...)
bars = wrangler.process(df)</code></pre>
</li>
<li><strong>æ­¥é©Ÿ 3</strong>: å­˜å…¥ <code>DataCatalog</code>ï¼ˆä¸€æ¬¡æ€§æ“ä½œï¼‰
                                <pre><code class="language-python">catalog = ParquetDataCatalog("./my_catalog")
catalog.write_data(bars)</code></pre>
</li>
<li><strong>æ­¥é©Ÿ 4</strong>: åœ¨ç­–ç•¥çš„ <code>on_start()</code> ä¸­è¨‚é–± 15 åˆ†é˜ K ç·š
                                <pre><code class="language-python">bar_type_15m = BarType.from_str(
    "BTC-USDT-PERP.BINANCE-15-MINUTE-LAST-INTERNAL"
)
self.subscribe_bars(bar_type_15m)</code></pre>
</li>
</ol>
<p>ğŸ’¡ <strong>é—œéµ</strong>ï¼šä½ ä¸éœ€è¦è‡ªå·±æŠŠ 1 åˆ†é˜ K ç·šåˆä½µæˆ 15 åˆ†é˜ï¼</p>
<p>NautilusTrader çš„ <code>BarAggregator</code> æœƒè‡ªå‹•å¹«ä½ åšã€‚ä½ åªéœ€è¦è¼‰å…¥ 1 åˆ†é˜æ•¸æ“šï¼Œç„¶å¾Œè¨‚é–± 15 åˆ†é˜ K ç·šã€‚</p>
</div>
</div>
<!-- ==================== -->
<h2>å…«ã€æœ¬æ¨¡çµ„é‡é»å›é¡§</h2>
<div class="card">
<div class="card-title">ğŸ“‹ ä½ æ‡‰è©²è¨˜ä½çš„é—œéµé»</div>
<ol>
<li><strong>Wrangler</strong>ï¼šæŠŠ pandas DataFrame è½‰æ›æˆ NautilusTrader å°ˆç”¨æ•¸æ“šå°è±¡</li>
<li><strong>DataCatalog</strong>ï¼šç”¨ Parquet æ ¼å¼å­˜å„²æ•¸æ“šï¼Œè®€å–é€Ÿåº¦æ¯” CSV å¿« 10-50 å€</li>
<li><strong>BarAggregator</strong>ï¼šè‡ªå‹•æŠŠå°æ™‚é–“æ¡†æ¶ K ç·šèšåˆæˆå¤§æ™‚é–“æ¡†æ¶ï¼ˆæ™‚é–“/æˆäº¤é‡/ç­†æ•¸/åƒ¹å€¼ï¼‰</li>
<li><strong>è‡ªå®šç¾©æ•¸æ“š</strong>ï¼šå¯ä»¥å®šç¾©è‡ªå·±çš„æ•¸æ“šé¡å‹ï¼ˆæƒ…ç·’ã€æ–°èç­‰ï¼‰</li>
<li><strong>åºåˆ—åŒ–æ ¼å¼</strong>ï¼šParquet å­˜æ•¸æ“šã€MsgPack å‚³ç¶²è·¯ã€JSON åšé…ç½®</li>
<li><strong>INTERNAL vs EXTERNAL</strong>ï¼šINTERNAL ç”±å¼•æ“è‡ªå·±èšåˆï¼ŒEXTERNAL ç”±å¤–éƒ¨æ•¸æ“šæºæä¾›</li>
</ol>
</div>
<!-- é é¢å°èˆª -->
<div class="page-nav">
<a href="../Module_05_MessageBus/index.html">
<span class="nav-label">â† ä¸Šä¸€ç« </span><span class="nav-title">æ¨¡çµ„ 05ï¼šæ¶ˆæ¯ç¸½ç·š</span>
</a>
<a href="../Module_06_Cache/index.html" style="text-align:right;">
<span class="nav-label">ä¸‹ä¸€ç«  â†’</span><span class="nav-title">æ¨¡çµ„ 06ï¼šç·©å­˜ç³»çµ±</span>
</a>
</div>
</div>
</div>
</div>
<button aria-label="å›åˆ°é ‚éƒ¨" class="back-to-top">â†‘</button>
<script src="../assets/lecture.js"></script>
</body>
</html>