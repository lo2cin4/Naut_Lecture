<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡çµ„ 11ï¼šç­–ç•¥é–‹ç™¼å®Œå…¨æŒ‡å— â€” NautilusTrader æ•™æ</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>

<body>
    <div class="page-wrapper">
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo"><span class="icon">ğŸš</span> NautilusTrader æ•™æ</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬é›¶éšæ®µï¼šèµ·æ­¥</div>
                </div>
                <a class="nav-item" href="../Module_00_Getting_Started/index.html"><span class="nav-num">00</span>
                    ç’°å¢ƒå®‰è£</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬ä¸€éšæ®µï¼šå…¨å±€èªè­˜</div>
                </div>
                <a class="nav-item" href="../Module_01_Why_NautilusTrader/index.html"><span class="nav-num">01</span>
                    ç‚ºä»€éº¼é¸æ“‡</a>
                <a class="nav-item" href="../Module_02_Architecture_Overview/index.html"><span class="nav-num">02</span>
                    æ•´é«”æ¶æ§‹</a>
                <a class="nav-item" href="../Module_03_Design_Philosophy/index.html"><span class="nav-num">03</span>
                    è¨­è¨ˆå“²å­¸</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬äºŒéšæ®µï¼šæ ¸å¿ƒçµ„ä»¶</div>
                </div>
                <a class="nav-item" href="../Module_04_Domain_Model/index.html"><span class="nav-num">04</span> é ˜åŸŸæ¨¡å‹</a>
                <a class="nav-item" href="../Module_05_MessageBus/index.html"><span class="nav-num">05</span> æ¶ˆæ¯ç¸½ç·š</a>
                <a class="nav-item" href="../Module_05B_Data_Management/index.html"><span class="nav-num">05B</span> æ•¸æ“šç®¡ç†</a>

                <a class="nav-item" href="../Module_06_Cache/index.html"><span class="nav-num">06</span> ç·©å­˜ç³»çµ±</a>
                <a class="nav-item" href="../Module_07_DataEngine/index.html"><span class="nav-num">07</span> æ•¸æ“šå¼•æ“</a>
                <a class="nav-item" href="../Module_08_ExecutionEngine/index.html"><span class="nav-num">08</span>
                    åŸ·è¡Œå¼•æ“</a>
                <a class="nav-item" href="../Module_09_RiskEngine/index.html"><span class="nav-num">09</span> é¢¨æ§å¼•æ“</a>
                <a class="nav-item" href="../Module_10_Portfolio/index.html"><span class="nav-num">10</span> æŠ•è³‡çµ„åˆ</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬ä¸‰éšæ®µï¼šå¯¦æˆ°æ‡‰ç”¨</div>
                </div>
                <a class="nav-item active" href="index.html"><span class="nav-num">11</span> ç­–ç•¥é–‹ç™¼</a>
                <a class="nav-item" href="../Module_12_Backtest_And_Live/index.html"><span class="nav-num">12</span>
                    å›æ¸¬èˆ‡å¯¦ç›¤</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬å››éšæ®µï¼šé€²éšæ“´å±•</div>
                </div>
                <a class="nav-item" href="../Module_13_Adapters_Extensions/index.html"><span class="nav-num">13</span>
                    é©é…å™¨èˆ‡æ“´å±•</a>
                <a class="nav-item" href="../Module_14_Configuration/index.html"><span class="nav-num">14</span> é…ç½®ç³»çµ±æ·±æ½›</a>
                <a class="nav-item" href="../Module_15_Live_Advanced/index.html"><span class="nav-num">15</span> å¯¦ç›¤éƒ¨ç½²é€²éš</a>
                <a class="nav-item" href="../Module_16_Accounting_Risk/index.html"><span class="nav-num">16</span> æœƒè¨ˆèˆ‡é¢¨æ§</a>
                <a class="nav-item" href="../Module_17_Advanced_Topics/index.html"><span class="nav-num">17</span> é€²éšä¸»é¡Œ</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬äº”éšæ®µï¼šå‹•æ‰‹ Lab</div>
                </div>
                <a class="nav-item" href="../Lab_01_Backtest_Workflow/index.html"><span class="nav-num">L1</span> Lab 01</a>
                <a class="nav-item" href="../Lab_02_Binance_Sandbox/index.html"><span class="nav-num">L2</span> Lab 02</a>
                <a class="nav-item" href="../Lab_03_Custom_Strategy/index.html"><span class="nav-num">L3</span> Lab 03</a>
            </div>
        </nav>

        <div class="main-content">
            <div class="top-bar">
                <button class="menu-toggle" aria-label="é–‹å•Ÿé¸å–®">â˜°</button>
                <div class="breadcrumb"><a href="../index.html">é¦–é </a><span class="separator">â€º</span>ç¬¬ä¸‰éšæ®µ<span
                        class="separator">â€º</span>æ¨¡çµ„ 11</div>
            </div>
            <div class="content-container">

                <span class="phase-label phase-3">ç¬¬ä¸‰éšæ®µï¼šå¯¦æˆ°æ‡‰ç”¨</span>
                <h1>æ¨¡çµ„ 11ï¼šç­–ç•¥é–‹ç™¼å®Œå…¨æŒ‡å—<span class="subtitle">å¾é›¶é–‹å§‹å¯«ä½ çš„ç¬¬ä¸€å€‹äº¤æ˜“ç­–ç•¥</span></h1>

                <p>NautilusTrader çš„ç­–ç•¥é–‹ç™¼éµå¾ªä¸€å€‹ç°¡å–®çš„æ¨¡å¼ï¼š
                    <strong>ç¹¼æ‰¿åŸºé¡ â†’ å¯¦ç¾å›èª¿ â†’ å¡«å…¥é‚è¼¯</strong>ã€‚é€™å€‹æ¨¡çµ„æœƒæ•™ä½ å¾é›¶é–‹å§‹å¯«å‡ºå®Œæ•´çš„äº¤æ˜“ç­–ç•¥ã€‚
                </p>

                <div class="callout callout-info">
                    <div class="callout-title">ğŸ’¡ ç‚ºä»€éº¼è¦ç”¨ Strategy åŸºé¡ï¼Œè€Œä¸æ˜¯è‡ªå·±å¯«ï¼Ÿ</div>
                    <p><strong>âŒ å¦‚æœè‡ªå·±å¾é›¶å¯«äº¤æ˜“é‚è¼¯</strong>ï¼šä½ éœ€è¦è‡ªå·±è™•ç†æ•¸æ“šè¨‚é–±ã€è¨‚å–®ç®¡ç†ã€æŒå€‰è¿½è¹¤ã€æ—¥èªŒè¨˜éŒ„ã€é¢¨æ§å°æ¥... è‡³å°‘ 2000 è¡Œä»£ç¢¼æ‰èƒ½åšåˆ° Strategy
                        åŸºé¡å…è²»çµ¦ä½ çš„åŠŸèƒ½ã€‚</p>
                    <p><strong>âœ… ç”¨ Strategy åŸºé¡</strong>ï¼šä½ åªéœ€è¦é—œå¿ƒã€Œä»€éº¼æ™‚å€™è²·ã€ä»€éº¼æ™‚å€™è³£ã€ã€‚å…¶é¤˜çš„åŸºç¤è¨­æ–½ï¼ˆç·©å­˜ã€æ¶ˆæ¯ç¸½ç·šã€è¨‚å–®å·¥å» ã€Portfolio æŸ¥è©¢ï¼‰å…¨éƒ¨è‡ªå‹•æ³¨å…¥ã€‚
                    </p>
                </div>

                <!-- ==================== -->
                <h2>ä¸€ã€Strategy åŸºé¡ â€” ä½ çš„ç­–ç•¥æ¡†æ¶</h2>
                <p>æ‰€æœ‰ç­–ç•¥éƒ½ç¹¼æ‰¿è‡ª <code>Strategy</code> åŸºé¡ã€‚å®ƒæä¾›äº†å®Œæ•´çš„ã€Œè…³æ‰‹æ¶ã€ï¼Œä½ åªéœ€è¦å¡«å…¥äº¤æ˜“é‚è¼¯ï¼š</p>

                <div class="mermaid-wrapper">
                    <div class="mermaid">
                        flowchart LR
                        subgraph lifecycle["ğŸ”„ ç­–ç•¥ç”Ÿå‘½é€±æœŸ"]
                        direction TB
                        init["__init__<br />åˆå§‹åŒ–é…ç½®å’ŒæŒ‡æ¨™"]
                        start["on_start()<br />è¨‚é–±æ•¸æ“šã€åˆå§‹åŒ–é‚è¼¯"]
                        running["é‹è¡Œä¸­"]
                        stop["on_stop()<br />æ¸…ç†è³‡æºã€å¹³å€‰"]
                        init --> start --> running --> stop
                        end

                        subgraph callbacks["ğŸ“¡ äº‹ä»¶å›èª¿ (é‹è¡Œä¸­)"]
                        direction TB
                        on_bar["on_bar(bar)"]
                        on_quote["on_quote_tick(tick)"]
                        on_trade["on_trade_tick(tick)"]
                        on_filled["on_order_filled(event)"]
                        end

                        running ==> callbacks

                        style lifecycle fill:#0f1419,stroke:#4fc3f7,stroke-width:1px
                        style callbacks fill:#0f1419,stroke:#ab47bc,stroke-width:1px
                    </div>
                    <div class="caption">åœ– 1ï¼šç­–ç•¥çš„ç”Ÿå‘½é€±æœŸå’Œå›èª¿æ–¹æ³•</div>
                </div>

                <h2>äºŒã€ç­–ç•¥æ¨¡æ¿ â€” æœ€å°å¯é‹è¡Œç­–ç•¥</h2>
                <pre><code class="language-python">from nautilus_trader.trading.strategy import Strategy
from nautilus_trader.config import StrategyConfig
from nautilus_trader.model.identifiers import InstrumentId
from nautilus_trader.model.data import Bar, BarType


class MyStrategyConfig(StrategyConfig, frozen=True):
    """ç­–ç•¥é…ç½® â€” æ‰€æœ‰å¯èª¿åƒæ•¸æ”¾é€™è£¡"""
    instrument_id: InstrumentId
    bar_type: BarType
    fast_ema_period: int = 10
    slow_ema_period: int = 20


class MyStrategy(Strategy):
    """ä½ çš„ç­–ç•¥ â€” å¡«å…¥äº¤æ˜“é‚è¼¯"""

    def __init__(self, config: MyStrategyConfig):
        super().__init__(config)
        # ä¿å­˜é…ç½®
        self.instrument_id = config.instrument_id
        self.bar_type = config.bar_type

        # åˆå§‹åŒ–æŒ‡æ¨™
        self.fast_ema = ExponentialMovingAverage(config.fast_ema_period)
        self.slow_ema = ExponentialMovingAverage(config.slow_ema_period)

    def on_start(self):
        """ç­–ç•¥å•Ÿå‹•æ™‚èª¿ç”¨ â€” è¨‚é–±æ•¸æ“š"""
        # è¨‚é–± K ç·šæ•¸æ“š
        self.subscribe_bars(self.bar_type)
        # è¨˜éŒ„æ—¥èªŒ
        self.log.info("ç­–ç•¥å·²å•Ÿå‹•")

    def on_bar(self, bar: Bar):
        """æ”¶åˆ°æ–° K ç·šæ™‚èª¿ç”¨ â€” æ ¸å¿ƒäº¤æ˜“é‚è¼¯"""
        # æ›´æ–°æŒ‡æ¨™
        self.fast_ema.update_raw(bar.close.as_double())
        self.slow_ema.update_raw(bar.close.as_double())

        # ç­‰æŒ‡æ¨™æº–å‚™å¥½
        if not self.fast_ema.initialized:
            return

        # ===== äº¤æ˜“é‚è¼¯ =====
        # å¿«ç·šä¸Šç©¿æ…¢ç·š â†’ è²·å…¥
        if self.fast_ema.value > self.slow_ema.value:
            if self.portfolio.is_flat(self.instrument_id):
                self._buy()

        # å¿«ç·šä¸‹ç©¿æ…¢ç·š â†’ è³£å‡º
        elif self.fast_ema.value < self.slow_ema.value:
            if self.portfolio.is_net_long(self.instrument_id):
                self._sell()

    def _buy(self):
        """å»ºç«‹å¤šé ­æŒå€‰"""
        order = self.order_factory.market(
            instrument_id=self.instrument_id,
            order_side=OrderSide.BUY,
            quantity=Quantity.from_str("0.01"),
        )
        self.submit_order(order)

    def _sell(self):
        """å¹³æ‰å¤šé ­æŒå€‰"""
        order = self.order_factory.market(
            instrument_id=self.instrument_id,
            order_side=OrderSide.SELL,
            quantity=Quantity.from_str("0.01"),
        )
        self.submit_order(order)

    def on_order_filled(self, event):
        """è¨‚å–®æˆäº¤å›èª¿"""
        self.log.info(f"è¨‚å–®æˆäº¤: {event}")

    def on_stop(self):
        """ç­–ç•¥åœæ­¢æ™‚èª¿ç”¨ â€” æ¸…ç†"""
        self.cancel_all_orders(self.instrument_id)
        self.close_all_positions(self.instrument_id)
        self.log.info("ç­–ç•¥å·²åœæ­¢")
</code></pre>

                <div class="callout callout-success">
                    <div class="callout-title">âœ… é€™å°±æ˜¯å®Œæ•´çš„ç­–ç•¥äº†ï¼</div>
                    <p>ä¸åˆ° 80 è¡Œä»£ç¢¼ï¼Œä½ å°±æ“æœ‰äº†ä¸€å€‹å®Œæ•´çš„ EMA äº¤å‰ç­–ç•¥ï¼šæœ‰é…ç½®ã€æœ‰æŒ‡æ¨™ã€æœ‰äº¤æ˜“é‚è¼¯ã€æœ‰é¢¨æ§ï¼ˆé€éå…¨å±€ RiskEngineï¼‰ã€‚åŒæ¨£çš„ä»£ç¢¼å¯ä»¥ç›´æ¥ç”¨åœ¨å›æ¸¬å’Œå¯¦ç›¤ä¸­ã€‚</p>
                </div>

                <!-- ==================== -->
                <h2>ä¸‰ã€æ ¸å¿ƒå›èª¿æ–¹æ³•ä¸€è¦½</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>å›èª¿æ–¹æ³•</th>
                                <th>è§¸ç™¼æ™‚æ©Ÿ</th>
                                <th>å¸¸ç”¨æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>on_start()</code></td>
                                <td>ç­–ç•¥å•Ÿå‹•</td>
                                <td>è¨‚é–±æ•¸æ“šã€è¼‰å…¥æ­·å²æŒ‡æ¨™å€¼</td>
                            </tr>
                            <tr>
                                <td><code>on_stop()</code></td>
                                <td>ç­–ç•¥åœæ­¢</td>
                                <td>å–æ¶ˆè¨‚å–®ã€å¹³å€‰</td>
                            </tr>
                            <tr>
                                <td><code>on_bar(bar)</code></td>
                                <td>æ”¶åˆ°æ–° K ç·š</td>
                                <td>æ›´æ–°æŒ‡æ¨™ã€åˆ¤æ–·é–‹å¹³å€‰</td>
                            </tr>
                            <tr>
                                <td><code>on_quote_tick(tick)</code></td>
                                <td>æ”¶åˆ°æ–°å ±åƒ¹</td>
                                <td>è§€å¯Ÿè²·è³£åƒ¹å·®</td>
                            </tr>
                            <tr>
                                <td><code>on_trade_tick(tick)</code></td>
                                <td>æ”¶åˆ°æ–°æˆäº¤</td>
                                <td>è§€å¯Ÿæˆäº¤é‡å’Œæ–¹å‘</td>
                            </tr>
                            <tr>
                                <td><code>on_order_filled(event)</code></td>
                                <td>è¨‚å–®æˆäº¤</td>
                                <td>è¨˜éŒ„æ—¥èªŒã€èª¿æ•´æŒå€‰</td>
                            </tr>
                            <tr>
                                <td><code>on_order_rejected(event)</code></td>
                                <td>è¨‚å–®è¢«æ‹’</td>
                                <td>è¨˜éŒ„éŒ¯èª¤ã€é‡è©¦</td>
                            </tr>
                            <tr>
                                <td><code>on_order_canceled(event)</code></td>
                                <td>è¨‚å–®è¢«å–æ¶ˆ</td>
                                <td>æ¸…ç†æ›å–®è¨˜éŒ„</td>
                            </tr>
                            <tr>
                                <td><code>on_position_opened(event)</code></td>
                                <td>æ–°æŒå€‰å»ºç«‹</td>
                                <td>è¨­ç½®æ­¢æ</td>
                            </tr>
                            <tr>
                                <td><code>on_position_closed(event)</code></td>
                                <td>æŒå€‰é—œé–‰</td>
                                <td>è¨˜éŒ„ç›ˆè™§</td>
                            </tr>
                            <tr>
                                <td><code>on_event(event)</code></td>
                                <td>ä»»ä½•äº‹ä»¶</td>
                                <td>é€šç”¨äº‹ä»¶è™•ç†</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ==================== -->
                <h2>å››ã€æŒ‡æ¨™ç³»çµ±</h2>
                <p>NautilusTrader å…§å»ºäº†è±å¯Œçš„æŠ€è¡“æŒ‡æ¨™ï¼š</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>é¡åˆ¥</th>
                                <th>æŒ‡æ¨™</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>è¶¨å‹¢</td>
                                <td>EMA, SMA, WMA, DEMA, TEMA, KAMA, HMA</td>
                            </tr>
                            <tr>
                                <td>å‹•é‡</td>
                                <td>RSI, MACD, Stochastic, CCI, ROC, Williams %R</td>
                            </tr>
                            <tr>
                                <td>æ³¢å‹•ç‡</td>
                                <td>ATR, Bollinger Bands, Keltner Channel, Donchian</td>
                            </tr>
                            <tr>
                                <td>æˆäº¤é‡</td>
                                <td>OBV, VWAP, MFI, AD</td>
                            </tr>
                            <tr>
                                <td>çµ±è¨ˆ</td>
                                <td>Standard Deviation, Variance, Linear Regression</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <pre><code class="language-python"># ä½¿ç”¨æŒ‡æ¨™çš„ä¸‰æ­¥æ›²
# 1. __init__ ä¸­å»ºç«‹
self.rsi = RelativeStrengthIndex(period=14)

# 2. on_bar ä¸­æ›´æ–°
self.rsi.update_raw(bar.close.as_double())

# 3. è®€å–å€¼
if self.rsi.initialized and self.rsi.value > 70:
    # RSI è¶…è²· â†’ è€ƒæ…®è³£å‡º
    pass</code></pre>

                <!-- ==================== -->
                <h2>å››Bã€Actor vs Strategy â€” ä»€éº¼æ™‚å€™è©²ç”¨å“ªå€‹ï¼Ÿ</h2>

                <div class="callout callout-info">
                    <div class="callout-title">ğŸ’¡ ç‚ºä»€éº¼è¦æœ‰ Actorï¼ŸStrategy ä¸å¤ å—ï¼Ÿ</div>
                    <p><strong>âŒ å¦‚æœæŠŠæ‰€æœ‰é‚è¼¯éƒ½å¡é€² Strategy</strong>ï¼šä½ çš„ç­–ç•¥æœƒè®Šæˆã€Œè¶…ç´šå¤§é¡ã€ï¼Œæ—¢åšæ•¸æ“šè™•ç†åˆåšäº¤æ˜“æ±ºç­–ã€‚é›£ä»¥æ¸¬è©¦ã€é›£ä»¥è¤‡ç”¨ã€‚</p>
                    <p><strong>âœ… ç”¨ Actor + Strategy</strong>ï¼šActor è² è²¬ã€Œè§€å¯Ÿå’Œè¨ˆç®—ã€ï¼ˆå¦‚ç”Ÿæˆä¿¡è™Ÿï¼‰ï¼ŒStrategy è² è²¬ã€Œäº¤æ˜“ã€ã€‚å®ƒå€‘ä¹‹é–“ç”¨ MessageBus
                        é€šè¨Šï¼Œå®Œå…¨è§£è€¦ã€‚</p>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>ç‰¹æ€§</th>
                                <th>Actor</th>
                                <th>Strategy</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>èƒ½è¨‚é–±æ•¸æ“š</td>
                                <td>âœ…</td>
                                <td>âœ…</td>
                            </tr>
                            <tr>
                                <td>èƒ½ä¸‹å–®</td>
                                <td>âŒ</td>
                                <td>âœ…</td>
                            </tr>
                            <tr>
                                <td>æœ‰ order_factory</td>
                                <td>âŒ</td>
                                <td>âœ…</td>
                            </tr>
                            <tr>
                                <td>æœ‰ portfolio è¨ªå•</td>
                                <td>âœ…ï¼ˆå”¯è®€ï¼‰</td>
                                <td>âœ…</td>
                            </tr>
                            <tr>
                                <td>å…¸å‹ç”¨é€”</td>
                                <td>ä¿¡è™Ÿç”Ÿæˆã€æ•¸æ“šè™•ç†ã€ç›£æ§</td>
                                <td>äº¤æ˜“é‚è¼¯ã€è¨‚å–®ç®¡ç†</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <pre><code class="language-python">"""Actor â†’ Strategy å”ä½œç¯„ä¾‹ï¼šä¿¡è™Ÿç”Ÿæˆå™¨ + äº¤æ˜“åŸ·è¡Œå™¨"""
from nautilus_trader.common.actor import Actor
from nautilus_trader.common.signal import Signal

class SignalGenerator(Actor):
    """Actorï¼šåªç”Ÿæˆä¿¡è™Ÿï¼Œä¸åšäº¤æ˜“"""
    def on_bar(self, bar: Bar):
        rsi = self._calculate_rsi(bar)
        if rsi < 30:
            # ç™¼å¸ƒã€Œå»ºè­°è²·å…¥ã€ä¿¡è™Ÿåˆ° MessageBus
            self.publish_signal(name="BUY", value=rsi)
        elif rsi > 70:
            self.publish_signal(name="SELL", value=rsi)

class TradeExecutor(Strategy):
    """Strategyï¼šæ¥æ”¶ä¿¡è™Ÿä¸¦åŸ·è¡Œäº¤æ˜“"""
    def on_start(self):
        self.subscribe_signal(name="BUY")
        self.subscribe_signal(name="SELL")

    def on_signal(self, signal: Signal):
        if signal.name == "BUY" and self.portfolio.is_flat(self.instrument_id):
            self._buy()
        elif signal.name == "SELL" and self.portfolio.is_net_long(self.instrument_id):
            self._sell()</code></pre>

                <!-- ==================== -->
                <h2>å››Cã€OrderFactory â€” é€²éšä¸‹å–®æ¨¡å¼</h2>

                <p><code>self.order_factory</code> æ˜¯ä½ åœ¨ç­–ç•¥ä¸­ä¸‹å–®çš„å”¯ä¸€å·¥å…·ã€‚å®ƒèƒ½å‰µå»ºæ‰€æœ‰ 11 ç¨®è¨‚å–®ï¼Œé€™è£¡å±•ç¤ºæœ€å¯¦ç”¨çš„å¹¾å€‹æ¨¡å¼ï¼š</p>

                <h3>æ¨¡å¼ 1ï¼šBracket Orderï¼ˆæ‹¬è™Ÿè¨‚å–® = å…¥å ´ + æ­¢æ + æ­¢ç›ˆï¼‰</h3>
                <pre><code class="language-python">"""ä¸€æ¬¡ä¸‹ä¸‰å€‹è¨‚å–®ï¼šå¸‚åƒ¹å…¥å ´ + æ­¢æ + æ­¢ç›ˆ"""
from nautilus_trader.model.orders import OrderList

def _open_position_with_bracket(self):
    # OrderList æŠŠä¸‰å€‹è¨‚å–®ç¶åœ¨ä¸€èµ·
    bracket = self.order_factory.bracket(
        instrument_id=self.instrument_id,
        order_side=OrderSide.BUY,
        quantity=Quantity.from_str("0.01"),
        # å…¥å ´ç”¨å¸‚åƒ¹å–®
        entry_trigger_price=None,  # å¸‚åƒ¹å…¥å ´
        # æ­¢æè¨­åœ¨å…¥å ´åƒ¹ä¸‹æ–¹ 2%
        sl_trigger_price=Price.from_str("49000.00"),
        # æ­¢ç›ˆè¨­åœ¨å…¥å ´åƒ¹ä¸Šæ–¹ 4%
        tp_price=Price.from_str("52000.00"),
    )
    # ä¸€æ¬¡æäº¤æ•´å€‹ bracket
    self.submit_order_list(bracket)
    # ç•¶å…¥å ´å–®æˆäº¤å¾Œï¼Œæ­¢æå’Œæ­¢ç›ˆè‡ªå‹•å•Ÿå‹•
    # ç•¶æ­¢ææˆ–æ­¢ç›ˆä»»ä¸€è§¸ç™¼ï¼Œå¦ä¸€å€‹è‡ªå‹•å–æ¶ˆï¼ˆOCOï¼‰</code></pre>

                <h3>æ¨¡å¼ 2ï¼šTrailing Stopï¼ˆç§»å‹•æ­¢æï¼‰</h3>
                <pre><code class="language-python">"""ç”¨ ATR å‹•æ…‹è¨ˆç®—æ­¢æè·é›¢"""
def _set_trailing_stop(self):
    atr_value = self.atr.value  # ATR æŒ‡æ¨™çš„ç•¶å‰å€¼

    order = self.order_factory.trailing_stop_market(
        instrument_id=self.instrument_id,
        order_side=OrderSide.SELL,  # è³£å‡ºæ­¢æ
        quantity=Quantity.from_str("0.01"),
        # æ­¢æè·é›¢ = 2 å€ ATR
        trailing_offset=Decimal(str(atr_value * 2)),
        trailing_offset_type=TrailingOffsetType.PRICE,
        trigger_type=TriggerType.LAST_TRADE,
    )
    self.submit_order(order)
    # åƒ¹æ ¼ä¸Šæ¼²æ™‚ï¼Œæ­¢æåƒ¹è·Ÿè‘—ä¸Šç§»
    # åƒ¹æ ¼ä¸‹è·Œè¶…é 2Ã—ATR æ™‚ï¼Œè§¸ç™¼æ­¢æ</code></pre>

                <!-- ==================== -->
                <h2>äº”ã€å®˜æ–¹ç¯„ä¾‹ç­–ç•¥è§£è®€</h2>
                <p>NautilusTrader é™„å¸¶äº† 17 å€‹å®˜æ–¹ç¯„ä¾‹ç­–ç•¥ï¼Œæ¶µè“‹å„ç¨®äº¤æ˜“æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯ç²¾é¸çš„ 5 å€‹æœ€æœ‰å­¸ç¿’åƒ¹å€¼çš„ï¼š</p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <span class="icon">ğŸ“</span>
                        <h4>ema_cross.py</h4>
                        <p><strong>EMA äº¤å‰ç­–ç•¥</strong><br />æœ€åŸºç¤çš„è¶¨å‹¢è·Ÿè¹¤ç­–ç•¥ã€‚å¿« EMA ä¸Šç©¿æ…¢ EMA åšå¤šï¼Œåä¹‹åšç©ºã€‚å­¸ç¿’ç­–ç•¥åŸºæœ¬çµæ§‹çš„æœ€ä½³èµ·é»ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">ğŸ“Š</span>
                        <h4>ema_cross_bracket.py</h4>
                        <p><strong>EMA äº¤å‰ + æ‹¬è™Ÿè¨‚å–®</strong><br />åœ¨ EMA äº¤å‰åŸºç¤ä¸ŠåŠ å…¥æ­¢ææ­¢ç›ˆï¼ˆBracket Orderï¼‰ï¼Œå±•ç¤ºæ¢ä»¶å–®çµ„åˆçš„ä½¿ç”¨ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">ğŸ“ˆ</span>
                        <h4>ema_cross_trailing_stop.py</h4>
                        <p><strong>ç§»å‹•æ­¢æç­–ç•¥</strong><br />ä½¿ç”¨ ATR æŒ‡æ¨™å‹•æ…‹è¨ˆç®—æ­¢æè·é›¢ï¼Œå±•ç¤ºå¦‚ä½•ç”¨ç§»å‹•æ­¢æé–å®šåˆ©æ½¤ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">ğŸ“–</span>
                        <h4>orderbook_imbalance.py</h4>
                        <p><strong>è¨‚å–®ç°¿å¤±è¡¡ç­–ç•¥</strong><br />åŸºæ–¼è¨‚å–®ç°¿è²·è³£å£“åŠ›å¤±è¡¡åšäº¤æ˜“ã€‚å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Level 2 æ•¸æ“šã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">ğŸ¯</span>
                        <h4>market_maker.py</h4>
                        <p><strong>åšå¸‚å•†ç­–ç•¥</strong><br />åœ¨è²·è³£å…©å´æ›å–®è³ºå–åƒ¹å·®ã€‚å±•ç¤ºé«˜é »äº¤æ˜“å’Œåº«å­˜ç®¡ç†çš„åŸºæœ¬é‚è¼¯ã€‚</p>
                    </div>
                </div>

                <!-- ==================== -->
                <h2>å…­ã€ç­–ç•¥é–‹ç™¼æœ€ä½³å¯¦è¸</h2>

                <div class="feature-grid">
                    <div class="feature-card">
                        <span class="icon">1ï¸âƒ£</span>
                        <h4>é…ç½®åˆ†é›¢</h4>
                        <p>æ‰€æœ‰å¯èª¿åƒæ•¸æ”¾åœ¨ <code>StrategyConfig</code> ä¸­ï¼Œä¸è¦ç¡¬ç·¨ç¢¼åœ¨ç­–ç•¥å…§ã€‚æ–¹ä¾¿å›æ¸¬æ™‚é€²è¡Œåƒæ•¸å„ªåŒ–ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">2ï¸âƒ£</span>
                        <h4>ç­‰å¾…æŒ‡æ¨™åˆå§‹åŒ–</h4>
                        <p>åœ¨ <code>on_bar()</code> ä¸­ï¼Œå¿…é ˆæª¢æŸ¥ <code>indicator.initialized</code>ï¼Œå¦å‰‡å‰å¹¾æ ¹ K ç·šçš„æŒ‡æ¨™å€¼æ˜¯ä¸æº–ç¢ºçš„ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">3ï¸âƒ£</span>
                        <h4>è¨˜éŒ„å……åˆ†æ—¥èªŒ</h4>
                        <p>ç”¨ <code>self.log.info()</code> è¨˜éŒ„é—œéµæ±ºç­–é»ã€‚å›æ¸¬æ™‚å¯ä»¥å›é¡§æ¯ä¸€å€‹äº¤æ˜“æ±ºç­–çš„åŸå› ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">4ï¸âƒ£</span>
                        <h4>on_stop() æ¸…ç†</h4>
                        <p>ç­–ç•¥åœæ­¢æ™‚å‹™å¿…å–æ¶ˆæ‰€æœ‰æ›å–®å’Œå¹³å€‰ã€‚é¿å…æ®˜ç•™è¨‚å–®åœ¨æ²’æœ‰ç›£æ§çš„æƒ…æ³ä¸‹åŸ·è¡Œã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">5ï¸âƒ£</span>
                        <h4>æª¢æŸ¥æŒå€‰å†ä¸‹å–®</h4>
                        <p>ä¸‹å–®å‰å…ˆç”¨ <code>self.portfolio.is_flat()</code> æª¢æŸ¥æŒå€‰ç‹€æ…‹ï¼Œé¿å…é‡è¤‡åŠ å€‰ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">6ï¸âƒ£</span>
                        <h4>ä½¿ç”¨è¨‚å–®å·¥å» </h4>
                        <p>å§‹çµ‚ç”¨ <code>self.order_factory</code> å‰µå»ºè¨‚å–®ï¼Œå®ƒæœƒè‡ªå‹•ç”Ÿæˆå”¯ä¸€çš„ ClientOrderId å’Œæ­£ç¢ºçš„ StrategyIdã€‚</p>
                    </div>
                </div>

                <!-- ==================== -->
                <h2>ä¸ƒã€äº’å‹•ç·´ç¿’</h2>
                <div class="exercise-block">
                    <div class="exercise-title">ğŸ§  ç·´ç¿’ 1ï¼šè¨­è¨ˆä¸€å€‹ RSI ç­–ç•¥</div>
                    <p>è¨­è¨ˆä¸€å€‹åŸºæ–¼ RSI çš„ç­–ç•¥ï¼šRSI &gt; 70 æ™‚è³£å‡ºï¼ˆè¶…è²·ï¼‰ï¼ŒRSI &lt; 30 æ™‚è²·å…¥ï¼ˆè¶…è³£ï¼‰ã€‚åˆ—å‡ºä½ éœ€è¦çš„å›èª¿æ–¹æ³•å’Œé‚è¼¯æµç¨‹ã€‚</p>
                    <button class="btn-run" onclick="toggleAnswer('answer-rsi')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="exercise-output" id="answer-rsi">éœ€è¦çš„çµæ§‹ï¼š

                        1. __init__: å»ºç«‹ RSI æŒ‡æ¨™ï¼ˆperiod=14ï¼‰
                        2. on_start: è¨‚é–± K ç·šæ•¸æ“š
                        3. on_bar:
                        - æ›´æ–° RSIï¼šself.rsi.update_raw(bar.close)
                        - æª¢æŸ¥åˆå§‹åŒ–ï¼šif not self.rsi.initialized: return
                        - RSI &lt; 30 ä¸”ç„¡æŒå€‰ â†’ self._buy()
                        - RSI &gt; 70 ä¸”æœ‰å¤šé ­æŒå€‰ â†’ self._sell()
                        4. on_order_filled: è¨˜éŒ„æˆäº¤æ—¥èªŒ
                        5. on_stop: å–æ¶ˆæ‰€æœ‰è¨‚å–®ã€å¹³å€‰

                        é¡å¤–åŠ åˆ†ï¼š
                        - åŠ å…¥ ATR è¨ˆç®—æ­¢æè·é›¢
                        - RSI å¾è¶…è³£å€å›å‡ï¼ˆç©¿é 30ï¼‰æ™‚æ‰è²·å…¥
                        - è¨­ç½®æœ€å¤§æŒå€‰é™åˆ¶</div>
                </div>

                <div class="exercise-block">
                    <div class="exercise-title">ğŸ§  ç·´ç¿’ 2ï¼šæ‰¾å‡ºä»£ç¢¼éŒ¯èª¤</div>
                    <p>ä»¥ä¸‹ç­–ç•¥ä»£ç¢¼æœ‰ <strong>3 å€‹éŒ¯èª¤</strong>ï¼Œä½ èƒ½æ‰¾åˆ°å—ï¼Ÿ</p>
                    <pre><code class="language-python">class BuggyStrategy(Strategy):
    def __init__(self, config):
        self.ema = ExponentialMovingAverage(20)  # ğŸ¤” éŒ¯èª¤ 1

    def on_start(self):
        self.subscribe_bars(self.config.bar_type)

    def on_bar(self, bar: Bar):
        self.ema.update_raw(bar.close)            # ğŸ¤” éŒ¯èª¤ 2
        if self.ema.value > bar.close.as_double():
            self._buy()

    def _buy(self):
        order = self.order_factory.market(
            instrument_id=self.instrument_id,
            order_side=OrderSide.BUY,
            quantity=Quantity.from_str("0.01"),
        )
        self.submit_order(order)                  # ğŸ¤” éŒ¯èª¤ 3ï¼ˆé‚è¼¯å•é¡Œï¼‰</code></pre>
                    <button class="btn-run" onclick="toggleAnswer('answer-bugs11')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="exercise-output" id="answer-bugs11">éŒ¯èª¤ 1: ç¼ºå°‘ super().__init__(config)
                        â†’ æ²’æœ‰åˆå§‹åŒ–çˆ¶é¡ï¼Œself.cache, self.log ç­‰å…¨éƒ¨ä¸å¯ç”¨
                        â†’ æ­£ç¢º: åŠ ä¸Š super().__init__(config)

                        éŒ¯èª¤ 2: bar.close æ˜¯ Price å°è±¡ï¼Œä¸æ˜¯ float
                        â†’ update_raw() éœ€è¦ float
                        â†’ æ­£ç¢º: self.ema.update_raw(bar.close.as_double())
                        ï¼ˆé€™å€‹å¯«å°äº†ä¸€åŠï¼šas_double() éœ€è¦åŠ æ‹¬è™Ÿï¼‰

                        éŒ¯èª¤ 3: æ²’æœ‰æª¢æŸ¥æŒå€‰ç‹€æ…‹å°±ä¸‹å–®
                        â†’ æ¯æ ¹ K ç·šéƒ½æœƒè§¸ç™¼è²·å…¥ï¼Œè¶Šè²·è¶Šå¤š
                        â†’ æ­£ç¢º: å…ˆæª¢æŸ¥ if self.portfolio.is_flat(self.instrument_id)</div>
                </div>

                <div class="exercise-block">
                    <div class="exercise-title">ğŸ§  ç·´ç¿’ 3ï¼šActor é‚„æ˜¯ Strategyï¼Ÿ</div>
                    <p>ä»¥ä¸‹å ´æ™¯ï¼Œä½ æ‡‰è©²ç”¨ Actor é‚„æ˜¯ Strategyï¼Ÿ</p>
                    <ol>
                        <li>ä½ æƒ³æŒçºŒç›£æ§ BTC å’Œ ETH çš„åƒ¹å·®ï¼Œç•¶åƒ¹å·®è¶…éé–¾å€¼æ™‚è¨˜éŒ„æ—¥èªŒ</li>
                        <li>ä½ æƒ³æ ¹æ“š RSI ä¿¡è™Ÿè‡ªå‹•è²·è³£</li>
                        <li>ä½ æƒ³å¾å¤–éƒ¨ API ç²å–æƒ…ç·’æ•¸æ“šä¸¦å»£æ’­åˆ°ç³»çµ±ä¸­</li>
                        <li>ä½ æƒ³åšä¸€å€‹çµ±è¨ˆå¥—åˆ©ç­–ç•¥ï¼ŒåŒæ™‚åœ¨å…©å€‹å“ç¨®ä¸Šä¸‹å–®</li>
                    </ol>
                    <button class="btn-run" onclick="toggleAnswer('answer-actor')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="exercise-output" id="answer-actor">1. Actor â† åªæ˜¯è§€å¯Ÿå’Œè¨˜éŒ„ï¼Œä¸éœ€è¦ä¸‹å–®
                        2. Strategy â† éœ€è¦ä¸‹å–®
                        3. Actor â† æ•¸æ“šè™•ç†å’Œå»£æ’­ï¼Œä¸æ¶‰åŠäº¤æ˜“
                        4. Strategy â† éœ€è¦åœ¨å¤šå€‹å“ç¨®ä¸Šä¸‹å–®

                        ğŸ’¡ åˆ¤æ–·æ¨™æº–å¾ˆç°¡å–®ï¼š
                        éœ€è¦ä¸‹å–® â†’ Strategy
                        ä¸éœ€è¦ä¸‹å–® â†’ Actor</div>
                </div>

                <!-- ==================== -->
                <h2>å…«ã€æœ¬æ¨¡çµ„é‡é»å›é¡§</h2>
                <div class="card">
                    <div class="card-title">ğŸ“‹ é—œéµé»</div>
                    <ol>
                        <li><strong>Strategy åŸºé¡</strong>æä¾›å®Œæ•´çš„æ¡†æ¶ï¼Œä½ åªéœ€å¡«å…¥é‚è¼¯</li>
                        <li><strong>ç”Ÿå‘½é€±æœŸ</strong>ï¼šinit â†’ on_start â†’ é‹è¡Œï¼ˆå›èª¿ï¼‰â†’ on_stop</li>
                        <li><strong>äº‹ä»¶å›èª¿</strong>ï¼šon_barã€on_quote_tickã€on_order_filled ç­‰</li>
                        <li><strong>æŒ‡æ¨™ç³»çµ±</strong>ï¼š30+ å…§å»ºæŒ‡æ¨™ï¼Œä¸‰æ­¥ä½¿ç”¨</li>
                        <li><strong>æœ€ä½³å¯¦è¸</strong>ï¼šé…ç½®åˆ†é›¢ã€ç­‰å¾…åˆå§‹åŒ–ã€è¨˜éŒ„æ—¥èªŒã€åœæ­¢æ™‚æ¸…ç†</li>
                        <li><strong>å®˜æ–¹ç¯„ä¾‹</strong>ï¼šå¾ ema_cross.py é–‹å§‹å­¸ç¿’</li>
                    </ol>
                </div>

                <div class="page-nav">
                    <a href="../Module_10_Portfolio/index.html"><span class="nav-label">â† ä¸Šä¸€ç« </span><span
                            class="nav-title">æ¨¡çµ„ 10ï¼šæŠ•è³‡çµ„åˆ</span></a>
                    <a href="../Module_12_Backtest_And_Live/index.html" style="text-align:right;"><span
                            class="nav-label">ä¸‹ä¸€ç«  â†’</span><span class="nav-title">æ¨¡çµ„ 12ï¼šå›æ¸¬ç³»çµ±èˆ‡å¯¦ç›¤éƒ¨ç½²</span></a>
                </div>
            </div>
        </div>
    </div>
    <button class="back-to-top" aria-label="å›åˆ°é ‚éƒ¨">â†‘</button>
    <script src="../assets/lecture.js"></script>
</body>

</html>