<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡çµ„ 15ï¼šå¯¦ç›¤éƒ¨ç½²é€²éš â€” NautilusTrader æ•™æ</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>

<body>
    <div class="page-wrapper">
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo"><span class="icon">ğŸš</span> NautilusTrader æ•™æ</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬é›¶éšæ®µï¼šèµ·æ­¥</div>
                </div>
                <a class="nav-item" href="../Module_00_Getting_Started/index.html"><span class="nav-num">00</span>
                    ç’°å¢ƒå®‰è£</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬ä¸€éšæ®µï¼šå…¨å±€èªè­˜</div>
                </div>
                <a class="nav-item" href="../Module_01_Why_NautilusTrader/index.html"><span class="nav-num">01</span>
                    ç‚ºä»€éº¼é¸æ“‡ NT</a>
                <a class="nav-item" href="../Module_02_Architecture_Overview/index.html"><span class="nav-num">02</span>
                    æ¶æ§‹é³¥ç°åœ–</a>
                <a class="nav-item" href="../Module_03_Design_Philosophy/index.html"><span class="nav-num">03</span>
                    è¨­è¨ˆå“²å­¸</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬äºŒéšæ®µï¼šæ ¸å¿ƒçµ„ä»¶</div>
                </div>
                <a class="nav-item" href="../Module_04_Domain_Model/index.html"><span class="nav-num">04</span> é ˜åŸŸæ¨¡å‹</a>
                <a class="nav-item" href="../Module_05_MessageBus/index.html"><span class="nav-num">05</span> æ¶ˆæ¯ç¸½ç·š</a>
                <a class="nav-item" href="../Module_05B_Data_Management/index.html"><span class="nav-num">05B</span>
                    æ•¸æ“šç®¡ç†</a>
                <a class="nav-item" href="../Module_06_Cache/index.html"><span class="nav-num">06</span> ç·©å­˜ç³»çµ±</a>
                <a class="nav-item" href="../Module_07_DataEngine/index.html"><span class="nav-num">07</span> æ•¸æ“šå¼•æ“</a>
                <a class="nav-item" href="../Module_08_ExecutionEngine/index.html"><span class="nav-num">08</span>
                    åŸ·è¡Œå¼•æ“</a>
                <a class="nav-item" href="../Module_09_RiskEngine/index.html"><span class="nav-num">09</span> é¢¨æ§å¼•æ“</a>
                <a class="nav-item" href="../Module_10_Portfolio/index.html"><span class="nav-num">10</span> æŠ•è³‡çµ„åˆ</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬ä¸‰éšæ®µï¼šå¯¦æˆ°æ‡‰ç”¨</div>
                </div>
                <a class="nav-item" href="../Module_11_Strategy_Development/index.html"><span class="nav-num">11</span>
                    ç­–ç•¥é–‹ç™¼</a>
                <a class="nav-item" href="../Module_12_Backtest_And_Live/index.html"><span class="nav-num">12</span>
                    å›æ¸¬èˆ‡å¯¦ç›¤</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬å››éšæ®µï¼šé€²éšæ“´å±•</div>
                </div>
                <a class="nav-item" href="../Module_13_Adapters_Extensions/index.html"><span class="nav-num">13</span>
                    é©é…å™¨èˆ‡æ“´å±•</a>
                <a class="nav-item" href="../Module_14_Configuration/index.html"><span class="nav-num">14</span>
                    é…ç½®ç³»çµ±æ·±æ½›</a>
                <a class="nav-item active" href="index.html"><span class="nav-num">15</span> å¯¦ç›¤éƒ¨ç½²é€²éš</a>
                <a class="nav-item" href="../Module_16_Accounting_Risk/index.html"><span class="nav-num">16</span>
                    æœƒè¨ˆèˆ‡é¢¨æ§</a>
                <a class="nav-item" href="../Module_17_Advanced_Topics/index.html"><span class="nav-num">17</span>
                    é€²éšä¸»é¡Œ</a>
                <div class="nav-section">
                    <div class="nav-section-title">ç¬¬äº”éšæ®µï¼šå‹•æ‰‹ Lab</div>
                </div>
                <a class="nav-item" href="../Lab_01_Backtest_Workflow/index.html"><span class="nav-num">L1</span> Lab 01</a>
                <a class="nav-item" href="../Lab_02_Binance_Sandbox/index.html"><span class="nav-num">L2</span> Lab 02</a>
                <a class="nav-item" href="../Lab_03_Custom_Strategy/index.html"><span class="nav-num">L3</span> Lab 03</a>
            </div>
        </nav>

        <div class="main-content">
            <div class="top-bar">
                <button class="menu-toggle" aria-label="é–‹å•Ÿé¸å–®">â˜°</button>
                <div class="breadcrumb"><a href="../index.html">é¦–é </a><span class="separator">â€º</span>ç¬¬å››éšæ®µ<span
                        class="separator">â€º</span>æ¨¡çµ„ 15</div>
            </div>
            <div class="content-container">

                <span class="phase-label phase-4">ç¬¬å››éšæ®µï¼šé€²éšæ“´å±•</span>
                <h1>æ¨¡çµ„ 15ï¼šå¯¦ç›¤éƒ¨ç½²é€²éš<span class="subtitle">å°å¸³ã€å®¹éŒ¯ã€æ§åˆ¶å™¨ â€” è®“ä½ çš„äº¤æ˜“ç³»çµ± 7Ã—24 ç©©å®šé‹è¡Œ</span></h1>

                <!-- ==================== -->
                <h2>ä¸€ã€å¯¦ç›¤èˆ‡å›æ¸¬çš„æ ¹æœ¬å·®ç•°</h2>

                <div class="callout callout-info">
                    <div class="callout-title">ğŸ’¡ ç‚ºä»€éº¼å¯¦ç›¤æ¯”å›æ¸¬è¤‡é›œ 10 å€ï¼Ÿ</div>
                    <p><strong>âŒ å›æ¸¬ä¸–ç•Œ</strong>ï¼šæ•¸æ“šå®Œç¾ã€ç¶²è·¯é›¶å»¶é²ã€äº¤æ˜“æ‰€æ°¸ä¸å‡ºéŒ¯ã€ç¨‹åºæ°¸ä¸å´©æ½°ã€‚</p>
                    <p><strong>âœ… å¯¦ç›¤ä¸–ç•Œ</strong>ï¼šç¶²è·¯æœƒæ–·ã€äº¤æ˜“æ‰€æœƒæ‹’å–®ã€API æœƒé™é€Ÿã€ç¨‹åºæœƒå´©æ½°ã€è¨‚å–®æœƒå¡ä½ã€‚NautilusTrader çš„ <code>live/</code>
                        æ¨¡çµ„å°±æ˜¯ç‚ºäº†å°ä»˜é€™äº›ã€Œç¾å¯¦ä¸–ç•Œçš„æ··äº‚ã€ã€‚</p>
                </div>

                <div class="mermaid-wrapper">
                    <div class="mermaid">
                        flowchart TB
                        subgraph live["ğŸš€ å¯¦ç›¤å°ˆå±¬æ©Ÿåˆ¶"]
                        direction LR
                        recon["ğŸ”„ Reconciliation<br />è¨‚å–®å°å¸³"]
                        retry["ğŸ” Retry<br />è‡ªå‹•é‡è©¦"]
                        ctrl["ğŸ® Controller<br />äº¤æ˜“æ§åˆ¶å™¨"]
                        filter["ğŸ“… Filters<br />äº¤æ˜“æ—¥æ›†"]
                        heartbeat["ğŸ’“ Heartbeat<br />å¿ƒè·³æª¢æ¸¬"]
                        end

                        recon --> |"ç¢ºä¿ä¸€è‡´æ€§"| safe["âœ… ç©©å®šé‹è¡Œ"]
                        retry --> |"å®¹éŒ¯"| safe
                        ctrl --> |"å…¨å±€æ§åˆ¶"| safe
                        filter --> |"é¿å…éäº¤æ˜“æ™‚æ®µ"| safe
                        heartbeat --> |"åŠæ™‚ç™¼ç¾æ–·ç·š"| safe

                        style live fill:#0f1419,stroke:#4fc3f7,stroke-width:2px
                        style safe fill:#0f1419,stroke:#4caf50,stroke-width:2px
                    </div>
                    <div class="caption">åœ– 1ï¼šå¯¦ç›¤å°ˆå±¬çš„ 5 å¤§ç©©å®šæ€§æ©Ÿåˆ¶</div>
                </div>

                <!-- ==================== -->
                <h2>äºŒã€Reconciliation â€” è¨‚å–®å°å¸³</h2>
                <p>å°å¸³æ˜¯å¯¦ç›¤ä¸­<strong>æœ€é‡è¦</strong>çš„æ©Ÿåˆ¶ã€‚å®ƒç¢ºä¿æœ¬åœ°ç³»çµ±çš„è¨‚å–®/æŒå€‰ç‹€æ…‹èˆ‡äº¤æ˜“æ‰€å®Œå…¨ä¸€è‡´ã€‚</p>

                <h3>ä»€éº¼æ™‚å€™éœ€è¦å°å¸³ï¼Ÿ</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <span class="icon">ğŸ”Œ</span>
                        <h4>ç¨‹åºå´©æ½°é‡å•Ÿ</h4>
                        <p>å´©æ½°æœŸé–“äº¤æ˜“æ‰€å¯èƒ½åŸ·è¡Œäº†ä½ çš„æ›å–®</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">ğŸ“¡</span>
                        <h4>ç¶²è·¯ä¸­æ–·æ¢å¾©</h4>
                        <p>æ–·ç·šæœŸé–“éŒ¯éäº†è¨‚å–®æˆäº¤å›å ±</p>
                    </div>
                    <div class="feature-card">
                        <span class="icon">â°</span>
                        <h4>æ¯æ—¥å®šæ™‚å•Ÿå‹•</h4>
                        <p>éš”å¤œå¯èƒ½æœ‰å€‰ä½è®ŠåŒ–ã€å¼·åˆ¶å¹³å€‰</p>
                    </div>
                </div>

                <h3>å°å¸³æµç¨‹</h3>
                <div class="mermaid-wrapper">
                    <div class="mermaid">
                        sequenceDiagram
                        participant NT as NautilusTrader
                        participant EX as Exchange

                        NT->>EX: 1. è«‹æ±‚æ‰€æœ‰ open orders
                        EX-->>NT: è¿”å› open orders list
                        NT->>NT: 2. æ¯”å°æœ¬åœ°è¨‚å–®ç‹€æ…‹
                        NT->>EX: 3. è«‹æ±‚å¸³æˆ¶é¤˜é¡å’ŒæŒå€‰
                        EX-->>NT: è¿”å›å¸³æˆ¶ç‹€æ…‹
                        NT->>NT: 4. æ¯”å°æœ¬åœ° Portfolio
                        Note over NT: 5. ç”Ÿæˆå·®ç•°å ±å‘Š
                        NT->>NT: 6. è‡ªå‹•ä¿®æ­£æœ¬åœ°ç‹€æ…‹
                    </div>
                    <div class="caption">åœ– 2ï¼šå°å¸³çš„å®Œæ•´æµç¨‹</div>
                </div>

                <pre><code class="language-python"># å•Ÿç”¨å°å¸³
from nautilus_trader.live.config import LiveExecEngineConfig

exec_config = LiveExecEngineConfig(
    reconciliation=True,                  # å•Ÿç”¨å°å¸³
    inflight_check_interval_ms=2000,      # æ¯ 2 ç§’æª¢æŸ¥é£›è¡Œä¸­è¨‚å–®
    inflight_check_threshold_ms=5000,     # è¶…é 5 ç§’æœªç¢ºèª â†’ å‘Šè­¦
)

# å°å¸³æœƒåœ¨å•Ÿå‹•æ™‚è‡ªå‹•åŸ·è¡Œï¼Œç„¡éœ€æ‰‹å‹•è§¸ç™¼
# è¶…æ™‚ç”± timeout_reconciliation æ§åˆ¶ï¼ˆé è¨­ 30sï¼‰</code></pre>

                <!-- ==================== -->
                <h2>ä¸‰ã€Retry â€” è‡ªå‹•é‡è©¦</h2>
                <p>ç•¶è¨‚å–®æäº¤å¤±æ•—æ™‚ï¼ˆç¶²è·¯è¶…æ™‚ã€API é™é€Ÿï¼‰ï¼Œç³»çµ±æœƒè‡ªå‹•é‡è©¦ï¼š</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>å ´æ™¯</th>
                                <th>è¡Œç‚º</th>
                                <th>æ³¨æ„</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ç¶²è·¯è¶…æ™‚</td>
                                <td>ç­‰å¾…å¾Œé‡è©¦</td>
                                <td>ä½¿ç”¨æŒ‡æ•¸é€€é¿é¿å…æ‰“çˆ† API</td>
                            </tr>
                            <tr>
                                <td>API é™é€Ÿ (429)</td>
                                <td>ç­‰å¾…é™é€Ÿçª—å£å¾Œé‡è©¦</td>
                                <td>æ­é… RiskEngine çš„ max_order_submit_rate</td>
                            </tr>
                            <tr>
                                <td>äº¤æ˜“æ‰€æ‹’çµ•</td>
                                <td>ä¸é‡è©¦ï¼Œè¨˜éŒ„éŒ¯èª¤</td>
                                <td>é¤˜é¡ä¸è¶³ã€åƒæ•¸éŒ¯èª¤ç­‰</td>
                            </tr>
                            <tr>
                                <td>é€£æ¥æ–·é–‹</td>
                                <td>ç­‰å¾…é‡é€£å¾Œé‡è©¦</td>
                                <td>Heartbeat æ©Ÿåˆ¶æœƒè§¸ç™¼é‡é€£</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ==================== -->
                <h2>å››ã€Trading Controller â€” äº¤æ˜“æ§åˆ¶å™¨</h2>
                <p>Controller æ˜¯ä¸€å€‹<strong>å…¨å±€æ§åˆ¶å™¨</strong>ï¼Œå¯ä»¥ç®¡ç†å¤šå€‹ç­–ç•¥çš„ç”Ÿå‘½é€±æœŸï¼š</p>

                <pre><code class="language-python">from nautilus_trader.trading.controller import Controller
from nautilus_trader.config import ControllerConfig

class MyController(Controller):
    """ç®¡ç†å¤šå€‹ç­–ç•¥çš„å•Ÿåœ"""

    def on_start(self):
        self.log.info("Controller å•Ÿå‹•")
        # å¯ä»¥åœ¨é€™è£¡æ ¹æ“šæ¢ä»¶æ±ºå®šå•Ÿå‹•å“ªäº›ç­–ç•¥

    def on_stop(self):
        self.log.info("Controller åœæ­¢")

    def on_trading_state_changed(self, state):
        """ç•¶äº¤æ˜“ç‹€æ…‹æ”¹è®Šæ™‚ï¼ˆå¦‚å¾ ACTIVE è®Šç‚º HALTEDï¼‰"""
        if state == TradingState.HALTED:
            self.log.warning("äº¤æ˜“æš«åœï¼å–æ¶ˆæ‰€æœ‰æ›å–®")
            for strategy in self.trader.strategies():
                strategy.cancel_all_orders(strategy.instrument_id)

    def create_actor(self, actor_config):
        """å‹•æ…‹å‰µå»º Actor"""
        pass

    def create_strategy(self, strategy_config):
        """å‹•æ…‹å‰µå»ºç­–ç•¥"""
        pass
</code></pre>

                <div class="callout callout-info">
                    <div class="callout-title">ğŸ’¡ Controller vs Strategy</div>
                    <p><strong>Strategy</strong>ï¼šè² è²¬ä¸€å€‹ç­–ç•¥çš„äº¤æ˜“é‚è¼¯ã€‚<br>
                        <strong>Controller</strong>ï¼šè² è²¬<strong>ç®¡ç†</strong>å¤šå€‹ Strategy çš„å•Ÿåœã€å‹•æ…‹å¢åˆªç­–ç•¥ã€‚åƒæ˜¯ã€Œç­–ç•¥çš„ç¶“ç†äººã€ã€‚
                    </p>
                </div>

                <!-- ==================== -->
                <h2>äº”ã€Trading Filters â€” äº¤æ˜“éæ¿¾å™¨</h2>
                <p>é¿å…åœ¨éäº¤æ˜“æ™‚æ®µæˆ–ç‰¹æ®Šæ—¥å­ä¸‹å–®ï¼š</p>

                <pre><code class="language-python">from nautilus_trader.trading.filters import (
    NewsImpactFilter,           # æ–°èäº‹ä»¶éæ¿¾
    ForexSessionFilter,         # å¤–åŒ¯äº¤æ˜“æ™‚æ®µ
    EconomicNewsEventFilter,    # ç¶“æ¿Ÿæ•¸æ“šç™¼å¸ƒ
)

# åœ¨ç­–ç•¥ä¸­ä½¿ç”¨
class MyStrategy(Strategy):

    def on_bar(self, bar):
        # è·³ééäº¤æ˜“æ™‚æ®µ
        if not self._is_trading_hours(bar.ts_event):
            return

        # è·³éé‡å¤§æ–°èå‰å¾Œ 30 åˆ†é˜
        if self._near_news_event(bar.ts_event, buffer_minutes=30):
            return

        # æ­£å¸¸äº¤æ˜“é‚è¼¯...
        self._check_entry_signal(bar)
</code></pre>

                <!-- ==================== -->
                <h2>å…­ã€Emulated Orders â€” æ¨¡æ“¬è¨‚å–®</h2>
                <p>æœ‰äº›äº¤æ˜“æ‰€ä¸æ”¯æŒæŸäº›è¨‚å–®é¡å‹ï¼ˆå¦‚ Trailing Stopï¼‰ã€‚NautilusTrader çš„ <code>OrderEmulator</code> å¯ä»¥åœ¨æœ¬åœ°æ¨¡æ“¬é€™äº›è¨‚å–®ï¼š</p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>è¨‚å–®é¡å‹</th>
                                <th>äº¤æ˜“æ‰€æ˜¯å¦åŸç”Ÿæ”¯æŒ</th>
                                <th>Emulator æ¨¡æ“¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Market Order</td>
                                <td>âœ… æ‰€æœ‰äº¤æ˜“æ‰€</td>
                                <td>ä¸éœ€è¦æ¨¡æ“¬</td>
                            </tr>
                            <tr>
                                <td>Limit Order</td>
                                <td>âœ… æ‰€æœ‰äº¤æ˜“æ‰€</td>
                                <td>ä¸éœ€è¦æ¨¡æ“¬</td>
                            </tr>
                            <tr>
                                <td>Stop Market</td>
                                <td>âš ï¸ å¤§éƒ¨åˆ†æ”¯æŒ</td>
                                <td>å¯é¸</td>
                            </tr>
                            <tr>
                                <td>Trailing Stop</td>
                                <td>âŒ éƒ¨åˆ†ä¸æ”¯æŒ</td>
                                <td>âœ… Emulator æ¨¡æ“¬</td>
                            </tr>
                            <tr>
                                <td>Market-If-Touched</td>
                                <td>âŒ éƒ¨åˆ†ä¸æ”¯æŒ</td>
                                <td>âœ… Emulator æ¨¡æ“¬</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <pre><code class="language-python">from nautilus_trader.common.config import OrderEmulatorConfig

emulator_config = OrderEmulatorConfig()

# åœ¨ TradingNodeConfig ä¸­å•Ÿç”¨
config = TradingNodeConfig(
    emulator=emulator_config,
    # ... å…¶ä»–é…ç½®
)

# ç„¶å¾Œåœ¨ç­–ç•¥ä¸­æ­£å¸¸ä½¿ç”¨ Trailing Stop
# å¦‚æœäº¤æ˜“æ‰€ä¸æ”¯æŒï¼ŒEmulator æœƒåœ¨æœ¬åœ°æ¨¡æ“¬å®ƒ
order = self.order_factory.trailing_stop_market(
    instrument_id=self.instrument_id,
    order_side=OrderSide.SELL,
    quantity=Quantity.from_str("1.0"),
    trailing_offset=Decimal("50"),
    trailing_offset_type=TrailingOffsetType.BASIS_POINTS,
    trigger_type=TriggerType.LAST_TRADE,
    emulation_trigger=TriggerType.LAST_TRADE,  # â† æŒ‡å®šæ¨¡æ“¬è§¸ç™¼
)</code></pre>

                <!-- ==================== -->
                <h2>ä¸ƒã€äº’å‹•ç·´ç¿’</h2>
                <div class="exercise-block">
                    <div class="exercise-title">ğŸ§  ç·´ç¿’ 1ï¼šå°å¸³å ´æ™¯åˆ†æ</div>
                    <p>ä½ çš„ç­–ç•¥åœ¨å‡Œæ™¨ 3 é»å´©æ½°äº†ï¼Œå‡Œæ™¨ 5 é»è‡ªå‹•é‡å•Ÿã€‚æœŸé–“æœ‰ä¸€ç­†é™åƒ¹è²·å…¥å–®åœ¨å‡Œæ™¨ 4 é»æˆäº¤äº†ã€‚é‡å•Ÿå¾Œæœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ</p>
                    <button class="btn-run" onclick="toggleAnswer('answer-recon')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="exercise-output" id="answer-recon">å¦‚æœé–‹å•Ÿäº† reconciliation=Trueï¼š

                        1. é‡å•Ÿæ™‚ç³»çµ±å‘äº¤æ˜“æ‰€è«‹æ±‚æ‰€æœ‰è¨‚å–®å’ŒæŒå€‰
                        2. ç™¼ç¾äº¤æ˜“æ‰€å ±å‘Šï¼šé™åƒ¹å–®å·² FILLED + æŒå€‰ +1
                        3. æœ¬åœ°ç‹€æ…‹ï¼šé™åƒ¹å–® SUBMITTEDï¼ˆæœªæ›´æ–°ï¼‰
                        4. å°å¸³å™¨è‡ªå‹•ä¿®æ­£ï¼š
                        - ç”Ÿæˆ OrderFilled äº‹ä»¶
                        - æ›´æ–°æœ¬åœ°æŒå€‰
                        - æ›´æ–° Portfolio é¤˜é¡
                        5. ç­–ç•¥æ”¶åˆ° on_order_filled å›èª¿
                        6. ç­–ç•¥å¯ä»¥ç¹¼çºŒæ­£å¸¸é‹ä½œ

                        å¦‚æœæ²’é–‹å°å¸³ï¼ˆreconciliation=Falseï¼‰ï¼š
                        âŒ æœ¬åœ°ä»¥ç‚ºå–®å­é‚„æ›è‘—
                        âŒ ä¸çŸ¥é“å·²ç¶“æœ‰æŒå€‰
                        âŒ å¯èƒ½é‡è¤‡ä¸‹å–® â†’ ç½é›£ï¼</div>
                </div>

                <div class="exercise-block">
                    <div class="exercise-title">ğŸ§  ç·´ç¿’ 2ï¼šController è¨­è¨ˆ</div>
                    <p>ä½ æœ‰ 3 å€‹ç­–ç•¥åŒæ™‚é‹è¡Œã€‚é€±æœ«å’Œç¾åœ‹å‡æœŸä¸æƒ³äº¤æ˜“ã€‚è¨­è¨ˆä¸€å€‹ Controller çš„ on_start é‚è¼¯ã€‚</p>
                    <button class="btn-run" onclick="toggleAnswer('answer-ctrl')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="exercise-output" id="answer-ctrl">è¨­è¨ˆæ€è·¯ï¼š

                        def on_start(self):
                        now = self.clock.utc_now()

                        # æª¢æŸ¥æ˜¯å¦ç‚ºé€±æœ«
                        if now.weekday() >= 5: # 6=é€±å…­, 7=é€±æ—¥
                        self.log.warning("é€±æœ«ï¼Œä¸å•Ÿå‹•ç­–ç•¥")
                        return

                        # æª¢æŸ¥æ˜¯å¦ç‚ºç¾åœ‹å‡æœŸ
                        us_holidays = [...] # é å®šç¾©çš„å‡æœŸåˆ—è¡¨
                        if now.date() in us_holidays:
                        self.log.warning(f"å‡æœŸ {now.date()}ï¼Œä¸å•Ÿå‹•ç­–ç•¥")
                        return

                        # å•Ÿå‹•æ‰€æœ‰ç­–ç•¥
                        for strategy in self.trader.strategies():
                        strategy.start()
                        self.log.info(f"å•Ÿå‹•ç­–ç•¥: {strategy.id}")

                        # è¨­å®šæ”¶ç›¤å‰è‡ªå‹•å¹³å€‰å®šæ™‚å™¨
                        self.clock.set_timer(
                        name="close_positions",
                        interval=timedelta(minutes=5),
                        callback=self._check_close_time,
                        )</div>
                </div>

                <div class="exercise-block">
                    <div class="exercise-title">ğŸ§  ç·´ç¿’ 3ï¼šEmulated vs Native</div>
                    <p>ä½ æƒ³ç”¨ Trailing Stopï¼Œä½†ä¸ç¢ºå®šäº¤æ˜“æ‰€æ˜¯å¦æ”¯æŒã€‚ç”¨ Emulator å’Œ Native å„æœ‰ä»€éº¼å„ªç¼ºé»ï¼Ÿ</p>
                    <button class="btn-run" onclick="toggleAnswer('answer-emu')">ğŸ’¡ æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="exercise-output" id="answer-emu">Nativeï¼ˆäº¤æ˜“æ‰€åŸç”Ÿæ”¯æŒï¼‰ï¼š
                        âœ… 0 å»¶é² â€” è§¸ç™¼å’ŒåŸ·è¡Œéƒ½åœ¨äº¤æ˜“æ‰€ç«¯
                        âœ… ä¸ä¾è³´ä½ çš„ç¨‹åº â€” å³ä½¿ä½ æ–·ç·šä¹ŸæœƒåŸ·è¡Œ
                        âŒ ä¸æ˜¯æ‰€æœ‰äº¤æ˜“æ‰€éƒ½æ”¯æŒ

                        Emulatedï¼ˆæœ¬åœ°æ¨¡æ“¬ï¼‰ï¼š
                        âœ… é©ç”¨æ–¼ä»»ä½•äº¤æ˜“æ‰€ â€” ä¸ç®¡äº¤æ˜“æ‰€æ˜¯å¦æ”¯æŒ
                        âœ… æ›´éˆæ´» â€” å¯ä»¥è‡ªå®šç¾©è§¸ç™¼é‚è¼¯
                        âŒ æœ‰å»¶é² â€” è§¸ç™¼å¾Œé‚„è¦ç™¼é€è¨‚å–®åˆ°äº¤æ˜“æ‰€
                        âŒ ä¾è³´ç¨‹åº â€” å¦‚æœç¨‹åºå´©æ½°ï¼Œæ¨¡æ“¬è¨‚å–®æ¶ˆå¤±

                        ğŸ’¡ æœ€ä½³å¯¦è¸ï¼š
                        å„ªå…ˆä½¿ç”¨ Nativeï¼Œåªæœ‰åœ¨äº¤æ˜“æ‰€ä¸æ”¯æŒæ™‚æ‰ç”¨ Emulated
                        å¦‚æœç”¨ Emulatedï¼Œç¢ºä¿æœ‰ save_state=True ä¿å­˜ç‹€æ…‹</div>
                </div>

                <h2>å…«ã€æœ¬æ¨¡çµ„é‡é»å›é¡§</h2>
                <div class="card">
                    <div class="card-title">ğŸ“‹ é—œéµé»</div>
                    <ol>
                        <li><strong>Reconciliation</strong>ï¼šå•Ÿå‹•æ™‚è‡ªå‹•å°å¸³ï¼Œç¢ºä¿æœ¬åœ°å’Œäº¤æ˜“æ‰€ç‹€æ…‹ä¸€è‡´</li>
                        <li><strong>Retry</strong>ï¼šè¨‚å–®æäº¤å¤±æ•—è‡ªå‹•é‡è©¦ï¼Œä½¿ç”¨æŒ‡æ•¸é€€é¿</li>
                        <li><strong>Controller</strong>ï¼šå…¨å±€ç®¡ç†å¤šå€‹ç­–ç•¥çš„å•Ÿåœå’Œç”Ÿå‘½é€±æœŸ</li>
                        <li><strong>Trading Filters</strong>ï¼šéæ¿¾éäº¤æ˜“æ™‚æ®µå’Œé‡å¤§æ–°èäº‹ä»¶</li>
                        <li><strong>OrderEmulator</strong>ï¼šåœ¨æœ¬åœ°æ¨¡æ“¬äº¤æ˜“æ‰€ä¸æ”¯æŒçš„è¨‚å–®é¡å‹</li>
                        <li><strong>Heartbeat</strong>ï¼šå®šæœŸå¿ƒè·³æª¢æ¸¬ï¼Œæ–·ç·šè‡ªå‹•é‡é€£</li>
                    </ol>
                </div>

                <div class="page-nav">
                    <a href="../Module_14_Configuration/index.html"><span class="nav-label">â† ä¸Šä¸€ç« </span><span
                            class="nav-title">æ¨¡çµ„ 14ï¼šé…ç½®ç³»çµ±æ·±æ½›</span></a>
                    <a href="../Module_16_Accounting_Risk/index.html" style="text-align:right;"><span
                            class="nav-label">ä¸‹ä¸€ç«  â†’</span><span class="nav-title">æ¨¡çµ„ 16ï¼šæœƒè¨ˆèˆ‡é¢¨æ§æ·±æ½›</span></a>
                </div>
            </div>
        </div>
    </div>
    <button class="back-to-top" aria-label="å›åˆ°é ‚éƒ¨">â†‘</button>
    <script src="../assets/lecture.js"></script>
</body>

</html>