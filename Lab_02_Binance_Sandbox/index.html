<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Lab 02ï¼šæ¥å…¥ Binance æ²™ç®± â€” NautilusTrader æ•™æ</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=Noto+Sans+TC:wght@300;400;500;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet"/>
<link href="../assets/style.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
<!-- Language Toggle -->
<style>
.lang-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(43, 48, 59, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 6px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    text-decoration: none;
    color: var(--text-secondary, #A0AEC0);
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.lang-toggle:hover {
    background: rgba(60, 65, 75, 0.9);
    color: var(--text-primary, #F7FAFC);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}
.lang-toggle span.active {
    color: #64ffda;
    font-weight: 600;
}
.lang-toggle svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
}
</style>
<a class="lang-toggle" href="../en/Lab_02_Binance_Sandbox/index.html" title="Switch to English">
<svg viewbox="0 0 24 24"><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>
<span>EN / <span class="active">ä¸­</span></span>
</a>

<!-- Language Toggle -->


<div class="page-wrapper">
<nav class="sidebar">
<div class="sidebar-header">
<div class="sidebar-logo"><span class="icon">ğŸš</span> NautilusTrader æ•™æ</div>
</div>
<div class="sidebar-nav">
<div class="nav-section">
<div class="nav-section-title">ç¬¬é›¶éšæ®µï¼šèµ·æ­¥</div>
</div>
<!-- ... omitted -> will be filled by script ... -->
<a class="nav-item" href="../Module_00_Getting_Started/index.html"><span class="nav-num">00</span>
                    ç’°å¢ƒå®‰è£</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬ä¸€éšæ®µï¼šå…¨å±€èªè­˜</div>
</div>
<a class="nav-item" href="../Module_01_Why_NautilusTrader/index.html"><span class="nav-num">01</span>
                    ç‚ºä»€éº¼é¸æ“‡ NT</a>
<a class="nav-item" href="../Module_02_Architecture_Overview/index.html"><span class="nav-num">02</span>
                    æ¶æ§‹é³¥ç°åœ–</a>
<a class="nav-item" href="../Module_03_Design_Philosophy/index.html"><span class="nav-num">03</span>
                    è¨­è¨ˆå“²å­¸</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬äºŒéšæ®µï¼šæ ¸å¿ƒçµ„ä»¶</div>
</div>
<a class="nav-item" href="../Module_04_Domain_Model/index.html"><span class="nav-num">04</span> é ˜åŸŸæ¨¡å‹</a>
<a class="nav-item" href="../Module_05_MessageBus/index.html"><span class="nav-num">05</span> æ¶ˆæ¯ç¸½ç·š</a>
<a class="nav-item" href="../Module_05B_Data_Management/index.html"><span class="nav-num">05B</span>
                    æ•¸æ“šç®¡ç†</a>
<a class="nav-item" href="../Module_06_Cache/index.html"><span class="nav-num">06</span> ç·©å­˜ç³»çµ±</a>
<a class="nav-item" href="../Module_07_DataEngine/index.html"><span class="nav-num">07</span> æ•¸æ“šå¼•æ“</a>
<a class="nav-item" href="../Module_08_ExecutionEngine/index.html"><span class="nav-num">08</span>
                    åŸ·è¡Œå¼•æ“</a>
<a class="nav-item" href="../Module_09_RiskEngine/index.html"><span class="nav-num">09</span> é¢¨æ§å¼•æ“</a>
<a class="nav-item" href="../Module_10_Portfolio/index.html"><span class="nav-num">10</span> æŠ•è³‡çµ„åˆ</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬ä¸‰éšæ®µï¼šå¯¦æˆ°æ‡‰ç”¨</div>
</div>
<a class="nav-item" href="../Module_11_Strategy_Development/index.html"><span class="nav-num">11</span>
                    ç­–ç•¥é–‹ç™¼</a>
<a class="nav-item" href="../Module_12_Backtest_And_Live/index.html"><span class="nav-num">12</span>
                    å›æ¸¬èˆ‡å¯¦ç›¤</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬å››éšæ®µï¼šé€²éšæ“´å±•</div>
</div>
<a class="nav-item" href="../Module_13_Adapters_Extensions/index.html"><span class="nav-num">13</span>
                    é©é…å™¨èˆ‡æ“´å±•</a>
<a class="nav-item" href="../Module_14_Configuration/index.html"><span class="nav-num">14</span>
                    é…ç½®ç³»çµ±æ·±æ½›</a>
<a class="nav-item" href="../Module_15_Live_Advanced/index.html"><span class="nav-num">15</span>
                    å¯¦ç›¤éƒ¨ç½²é€²éš</a>
<a class="nav-item" href="../Module_16_Accounting_Risk/index.html"><span class="nav-num">16</span>
                    æœƒè¨ˆèˆ‡é¢¨æ§</a>
<a class="nav-item" href="../Module_17_Advanced_Topics/index.html"><span class="nav-num">17</span>
                    é€²éšä¸»é¡Œ</a>
<div class="nav-section">
<div class="nav-section-title">ç¬¬äº”éšæ®µï¼šå‹•æ‰‹ Lab</div>
</div>
<a class="nav-item" href="../Lab_01_Backtest_Workflow/index.html"><span class="nav-num">L1</span> Lab
                    01</a>
<a class="nav-item active" href="index.html"><span class="nav-num">L2</span> Lab 02</a>
<a class="nav-item" href="../Lab_03_Custom_Strategy/index.html"><span class="nav-num">L3</span> Lab
                    03</a>
</div>
</nav>
<div class="main-content">
<div class="top-bar">
<button aria-label="é–‹å•Ÿé¸å–®" class="menu-toggle">â˜°</button>
<div class="breadcrumb"><a href="../index.html">é¦–é </a><span class="separator">â€º</span>ç¬¬äº”éšæ®µ<span class="separator">â€º</span>Lab 02</div>
</div>
<div class="content-container">
<span class="phase-label phase-5">ç¬¬äº”éšæ®µï¼šå‹•æ‰‹ Lab</span>
<h1>Lab 02ï¼šæ¥å…¥ Binance æ²™ç®±<span class="subtitle">å‹•æ‰‹å¯¦ä½œï¼šé€£æ¥çœŸå¯¦äº¤æ˜“æ‰€çš„æ¸¬è©¦ç’°å¢ƒï¼Œé«”é©—ã€Œå¯¦ç›¤ã€çš„æ„Ÿè¦º</span></h1>
<!-- ==================== -->
<h2>ç›®æ¨™</h2>
<ol>
<li>ç”³è«‹ Binance Testnet (Futures) API Key</li>
<li>é…ç½® <code>TradingNode</code> é€£æ¥æ²™ç®±ç’°å¢ƒ</li>
<li>é‹è¡Œç°¡å–®çš„ç­–ç•¥é€²è¡Œæ¨¡æ“¬äº¤æ˜“</li>
<li>è§€å¯Ÿæ§åˆ¶å°æ—¥èªŒå’Œè¨‚å–®ç‹€æ…‹</li>
</ol>
<div class="callout callout-warning">
<div class="callout-title">âš ï¸ å‰ç½®æ¢ä»¶</div>
<p>ä½ éœ€è¦ä¸€å€‹èƒ½è¨ªå• Binance æ¸¬è©¦ç¶²çš„ç¶²è·¯ç’°å¢ƒï¼ˆéƒ¨åˆ†åœ°å€å¯èƒ½éœ€ VPNï¼‰ã€‚<br/>
                        ä½ éœ€è¦å®‰è£ Redisï¼ˆDocker æˆ–æœ¬åœ°å®‰è£ï¼‰ã€‚</p>
</div>
<!-- ==================== -->
<h2>æ­¥é©Ÿ 1ï¼šç”³è«‹ API Key</h2>
<ol>
<li>è¨ªå• <a href="https://testnet.binancefuture.com/" target="_blank">Binance Futures Testnet</a>ã€‚
                    </li>
<li>è¨»å†Š/ç™»å…¥å¸³è™Ÿã€‚</li>
<li>åœ¨é é¢ä¸‹æ–¹æ‰¾åˆ° API Key å’Œ Secret Keyã€‚</li>
<li><strong>ä¿å­˜å¥½é€™å…©çµ„é‡‘é‘°ï¼</strong></li>
</ol>
<!-- ==================== -->
<h2>æ­¥é©Ÿ 2ï¼šé…ç½® .env æ–‡ä»¶</h2>
<p>ç‚ºäº†å®‰å…¨ï¼Œæˆ‘å€‘ä¸è¦æŠŠ Key å¯«åœ¨ä»£ç¢¼è£¡ã€‚å‰µå»ºä¸€å€‹ <code>.env</code> æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">BINANCE_API_KEY=ä½ çš„API_KEY
BINANCE_API_SECRET=ä½ çš„SECRET_KEY</code></pre>
<p>å®‰è£ <code>python-dotenv</code>ï¼š</p>
<pre><code class="language-bash">pip install python-dotenv</code></pre>
<!-- ==================== -->
<h2>æ­¥é©Ÿ 3ï¼šç·¨å¯«å•Ÿå‹•è…³æœ¬ (run_sandbox.py)</h2>
<pre><code class="language-python">import os
from dotenv import load_dotenv
from decimal import Decimal

from nautilus_trader.live.node import TradingNode
from nautilus_trader.live.config import (
    TradingNodeConfig,
    LiveDataEngineConfig,
    LiveExecEngineConfig,
)
from nautilus_trader.adapters.binance.config import (
    BinanceLiveDataClientConfig,
    BinanceLiveExecClientConfig,
)
from nautilus_trader.model.enums import AccountType, OmsType
from nautilus_trader.model.identifiers import TraderId

# 1. è¼‰å…¥ç’°å¢ƒè®Šé‡
load_dotenv()
API_KEY = os.getenv("BINANCE_API_KEY")
API_SECRET = os.getenv("BINANCE_API_SECRET")

# 2. æ§‹å»ºé…ç½®
node_config = TradingNodeConfig(
    trader_id=TraderId("SANDBOX-001"),
    
    # è³‡æ–™å®¢æˆ¶ç«¯ (æ¥æ”¶è¡Œæƒ…)
    data_clients={
        "BINANCE": BinanceLiveDataClientConfig(
            api_key=API_KEY,
            api_secret=API_SECRET,
            usdt_futures=True,  # ä½¿ç”¨ U æœ¬ä½åˆç´„
            testnet=True,       # !é‡è¦! é€£æ¥æ¸¬è©¦ç¶²
        ),
    },
    
    # åŸ·è¡Œå®¢æˆ¶ç«¯ (ä¸‹å–®)
    exec_clients={
        "BINANCE": BinanceLiveExecClientConfig(
            api_key=API_KEY,
            api_secret=API_SECRET,
            usdt_futures=True,
            testnet=True,
        ),
    },
    
    # å¼•æ“é…ç½®
    data_engine=LiveDataEngineConfig(time_bars_feed_only=True), # åƒ…è¨‚é–± 1m Kç·šä»¥ç¯€çœæµé‡
    exec_engine=LiveExecEngineConfig(reconciliation=True),      # å•Ÿç”¨å°å¸³
)

# 3. å‰µå»ºç¯€é»
node = TradingNode(config=node_config)

# 4. å®šç¾©ä¸€å€‹ç°¡å–®çš„æ‰“å°ç­–ç•¥ (ç”¨æ–¼æ¸¬è©¦é€£æ¥)
from nautilus_trader.trading.strategy import Strategy
from nautilus_trader.config import StrategyConfig

class PrintBarStrategy(Strategy):
    def on_bar(self, bar):
        self.log.info(f"æ”¶åˆ° Bar: {bar}")

# 5. æ·»åŠ ç­–ç•¥
config = StrategyConfig(instrument_id="BTCUSDT-PERP.BINANCE")
node.trader.add_strategy(PrintBarStrategy(config))

# 6. é‹è¡Œï¼
if __name__ == "__main__":
    node.run()</code></pre>
<!-- ==================== -->
<h2>æ­¥é©Ÿ 4ï¼šé‹è¡Œçµæœ</h2>
<p>é‹è¡Œè…³æœ¬å¾Œï¼Œä½ æ‡‰è©²æœƒåœ¨æ§åˆ¶å°çœ‹åˆ°é¡ä¼¼è¼¸å‡ºï¼š</p>
<pre><code class="language-text">[INFO] Node: Starting...
[INFO] TradingNode: Connecting to data clients...
[INFO] BinanceLiveDataClient: Connected to wss://stream.binancefuture.com...
[INFO] TradingNode: Connecting to execution clients...
[INFO] BinanceLiveExecClient: Connected...
[INFO] TradingNode: Starting strategies...
[INFO] PrintBarStrategy: æ”¶åˆ° Bar: Bar(BTCUSDT-PERP.BINANCE, ...)
...</code></pre>
<div class="callout callout-success">
<div class="callout-title">ğŸ‰ æˆåŠŸé€£æ¥ï¼</div>
<p>é€™æ„å‘³è‘—ä½ çš„ NautilusTrader å·²ç¶“æˆåŠŸé€£ä¸Šäº† Binance çš„æœå‹™å™¨ï¼Œä¸¦ä¸”é–‹å§‹æ¥æ”¶å¯¦æ™‚æ•¸æ“šäº†ã€‚é€™å°±æ˜¯å¯¦ç›¤äº¤æ˜“çš„åŸºç¤ï¼</p>
</div>
<!-- ==================== -->
<h2>ä½œæ¥­</h2>
<div class="exercise-block">
<div class="exercise-title">ğŸ“ æŒ‘æˆ°ä»»å‹™</div>
<p>1. å°‡ Lab 01 ä¸­çš„ EMA Cross ç­–ç•¥ç§»éä¾†ï¼Œé…ç½®åˆ° <code>run_sandbox.py</code> ä¸­ã€‚</p>
<p>2. å˜—è©¦ä¿®æ”¹ <code>trade_size</code> ç‚º <code>0.001</code> BTCï¼Œä¸¦è§€å¯Ÿæ˜¯å¦èƒ½æˆäº¤ï¼ˆæ³¨æ„ Binance çš„æœ€å°ä¸‹å–®æ•¸é‡ï¼‰ã€‚</p>
<p>3. åœ¨ Binance æ¸¬è©¦ç¶²çš„ç¶²é ç«¯æŸ¥çœ‹ä½ çš„å¸³æˆ¶ï¼Œç¢ºèªè¨‚å–®æ˜¯å¦çœŸçš„å‡ºç¾äº†ã€‚</p>
</div>
<div class="page-nav">
<a href="../Lab_01_Backtest_Workflow/index.html"><span class="nav-label">â† ä¸Šä¸€ç« </span><span class="nav-title">Lab 01ï¼šå¾é›¶åˆ°å›æ¸¬</span></a>
<a href="../Lab_03_Custom_Strategy/index.html" style="text-align:right;"><span class="nav-label">ä¸‹ä¸€ç« 
                            â†’</span><span class="nav-title">Lab 03ï¼šè‡ªå®šç¾©æŒ‡æ¨™èˆ‡ç­–ç•¥</span></a>
</div>
</div>
</div>
</div>
<button aria-label="å›åˆ°é ‚éƒ¨" class="back-to-top">â†‘</button>
<script src="../assets/lecture.js"></script>
</body>
</html>